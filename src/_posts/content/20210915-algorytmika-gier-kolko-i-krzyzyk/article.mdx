import Link from 'next/link';
import {Image, Iframe} from '@swistak-codes/components';
import cover from './kolko_krzyzyk.jpg';
import blokRozgalezienie from './BLOK-ROZGALEZIENIE.png';
import blokuj from './BLOKUJ.png';
import minimax from './minimax.png';
import rozgalezienie from './rozgalezienie_poprawione.png';
import kolkoKrzyzyk from './Tic-tac-toe-full-game-tree-x-rational.png';
import win10 from './win10_smooth.webp';
import wygraj from './WYGRAJ.png';

export const meta = {
  title: 'Algorytmika gier â€” kÃ³Å‚ko i krzyÅ¼yk',
  abstract:
    'PokazujÄ™ dwa sposoby na zrobienie sztucznej inteligencji dla gry w kÃ³Å‚ko i krzyÅ¼yk: wykorzystanie reguÅ‚ decyzyjnych oraz algorytm Minimax.',
  firstParagraph: (
    <>
      Poprzednio w serii algorytmika gier pochyliÅ‚em siÄ™ nad <Link href="/post/algorytmika-gier-saper">grÄ… w sapera</Link>, gdzie przeanalizowaliÅ›my, jak generuje siÄ™ planszÄ™ oraz prowadzi rozgrywkÄ™. Teraz sprÃ³bujmy przenieÅ›Ä‡ na komputer jednÄ… z najpopularniejszych gier rozgrywanych na kartce â€” kÃ³Å‚ko i krzyÅ¼yk. Jednak tym razem nie skupimy siÄ™ na zaprogramowaniu caÅ‚ej rozgrywki, a tylko na jednej rzeczy: <Link href="/post/sztuczna-inteligencja-a-co-to-a-komu-to-potrzebne">sztucznej inteligencji</Link> komputerowego gracza.
    </>
  ),
  keyword: 'kÃ³Å‚ko i krzyÅ¼yk',
  categories: ['Gry', 'Sztuczna inteligencja'],
  tags: [
    'sztuczna inteligencja',
    'minimax',
    'kÃ³Å‚ko i krzyÅ¼yk',
    'drzewo decyzyjne',
    'alfa-beta',
    'drzewo stanu gry',
    'gra o sumie zerowej',
    'javascript',
    'react',
    'drzewa',
  ],
  slug: 'algorytmika-gier-kolko-i-krzyzyk',
  updateTime: '2021-09-10T07:22:40+00:00',
  publishTime: '2021-09-15T07:30:02+00:00',
  cover,
};

## Uwaga wstÄ™pna

Podobnie jak w poprzednim artykule o saperze, takÅ¼e i tu zachÄ™cam do sprÃ³bowania zaprogramowania algorytmÃ³w na wÅ‚asnÄ… rÄ™kÄ™. Nie jest to wymagane dla zrozumienia artykuÅ‚u, ale zawsze pomoÅ¼e wynieÅ›Ä‡ z niego coÅ› wiÄ™cej.

[Pod tym linkiem](https://codesandbox.io/s/tictactoe-template-dn9dh?) udostÄ™pniam szablon zawierajÄ…cy grÄ™ w kÃ³Å‚ko i krzyÅ¼yk napisanÄ… w JavaScript z pomocÄ… Reacta. W pliku `src/logic/computeComputerMove.js` znajdziesz pustÄ… funkcjÄ™ `computeComputerMove`, ktÃ³rej zadaniem jest zwrÃ³cenie wspÃ³Å‚rzÄ™dnych pola, na ktÃ³rym ma zostaÄ‡ wykonany nastÄ™pny ruch.

W artykule pokaÅ¼Ä™ dwa algorytmy, wiÄ™c moÅ¼esz sprÃ³bowaÄ‡ zaprogramowaÄ‡ oba. Natomiast jeÅ›li chciaÅ‚byÅ›/chciaÅ‚abyÅ› po prostu zobaczyÄ‡ gotowca, to zapraszam na repozytorium na [GitHubie](https://github.com/swistak-codes/tic-tac-toe), gdzie znajdziesz gotowe implementacje.

## Jak siÄ™ w to gra?

ParafrazujÄ…c klasyka, chciaÅ‚oby siÄ™ powiedzieÄ‡, Å¼e jakie kÃ³Å‚ko i krzyÅ¼yk jest, kaÅ¼dy widzi. Jednak mimo wszystko przypomnijmy sobie podstawowe zasady gry.

W najpopularniejszym wariancie grÄ™ rozgrywa siÄ™ na polu o wymiarach 3 Ã— 3. Jeden z graczy gra krzyÅ¼ykami (najczÄ™Å›ciej ten wÅ‚aÅ›nie zaczyna), drugi kÃ³Å‚kami. KaÅ¼dy z graczy na przemian stawia w jednym z niezajÄ™tych pÃ³l swÃ³j symbol. Koniec gry nastÄ™puje wtedy, gdy ktÃ³ryÅ› z graczy utworzy liniÄ™ trzech swoich elementÃ³w (pionowa, pozioma lub po przekÄ…tnej; wÃ³wczas wygrywa), albo gdy wszystkie pola zostanÄ… zajÄ™te (remis).

Dla utrwalenia zasad moÅ¼esz zagraÄ‡ w kÃ³Å‚ko i krzyÅ¼yk z komputerowym graczem poniÅ¼ej (grasz krzyÅ¼ykami i zaczynasz).  DokÅ‚adnie to, co tutaj widzisz, jest efektem tego artykuÅ‚u.

<Iframe src="/iframe-content/tictactoe/demo/index.html" minHeight={280} />

## TrochÄ™ matematyki

WrÃ³Ä‡my do teorii gry w kÃ³Å‚ko i krzyÅ¼yk. Z racji tego, Å¼e gra jest turowa i potrzebne sÄ… trzy ruchy jednego gracza do zwyciÄ™stwa, oznacza to, Å¼e kaÅ¼da gra odbÄ™dzie siÄ™ w co najmniej 5 ruchach z 9 moÅ¼liwych. Daje to nieduÅ¼Ä… liczbÄ™ moÅ¼liwych rozgrywek. Pierwsze, co przychodzi na myÅ›l, biorÄ…c pod uwagÄ™ wiedzÄ™ z dziedziny kombinatoryki, to Å¼e moÅ¼liwych rozgrywek jest $$9! = 362880$$. Tak jednak nie jest, poniewaÅ¼ nie zawsze wykorzystujemy caÅ‚Ä… planszÄ™. Przypomnijmy sobie, Å¼e pierwszy gracz moÅ¼e zakoÅ„czyÄ‡ grÄ™ juÅ¼ po 5 ruchach (3 swoich). Do tego momentu mamy moÅ¼liwych $$9\cdot 8\cdot 7 \cdot 6 = 15120$$ gier, z czego tylko czÄ™Å›Ä‡ jest zakoÅ„czona.

To ile tych gier jest ostatecznie? MoÅ¼emy to policzyÄ‡ nastÄ™pujÄ…co dla gier koÅ„czÄ…cych siÄ™ piÄ™cioma ruchami:

- Mamy 8 moÅ¼liwoÅ›ci uÅ‚oÅ¼enia 3 symboli w jednej linii. MoÅ¼emy je ukÅ‚adaÄ‡ w dowolnej kolejnoÅ›ci na $$8 \cdot 3! = 48$$ sposobÃ³w.
- PozostaÅ‚y gracz ma do wyboru 6, a potem 5 pÃ³l, gdzie moÅ¼e postawiÄ‡ swÃ³j symbol. Daje to liczbÄ™ kombinacji $$6 \cdot 5 = 30$$.
- ÅÄ…cznie daje to nam $$8 \cdot 3! \cdot 6 \cdot 5 = 48 \cdot 30 = 1440$$ zwyciÄ™skich gier z 15120 moÅ¼liwych rozegraÅ„ do tego momentu.

Dla dalszych ruchÃ³w obliczenia robiÄ… siÄ™ bardziej skomplikowane, dlatego pominÄ™ ich wytÅ‚umaczenie, tylko wypiszÄ™ wzory:

- Gry koÅ„czÄ…ce siÄ™ wygranÄ… w 6 ruchach: $$8 \cdot 3! \cdot 6 \cdot 5 \cdot 4 - 6 \cdot 3! \cdot 2 \cdot 3! = 5328$$.
- W 7 ruchach: $$8 \cdot 3 \cdot 6 \cdot 3! \cdot 5 \cdot 4 \cdot 3 - 6 \cdot 3 \cdot 6 \cdot 3! \cdot 3! = 47952$$.
- W 8 ruchach: $$8 \cdot 3 \cdot 6 \cdot 3! \cdot 5 \cdot 4 \cdot 3 \cdot 2 - 6 \cdot 3 \cdot 6 \cdot 3! \cdot 2 \cdot 4! = 72576$$.
- W 9 ruchach: $$2 \cdot 3 \cdot 8 \cdot 4! \cdot 4! + 6 \cdot 3 \cdot 4 \cdot 4! \cdot 4! + 22 \cdot 1 \cdot 4! \cdot 4! = 81792$$.
- Remisy: $$16 \cdot 5! \cdot 4! = 46080$$.
- ÅÄ…cznie wszystkich moÅ¼liwych gier mamy $$1440+5328+47952+72576+81792+46080 = 255168$$.

## Strategia wygrywania w kÃ³Å‚ko i krzyÅ¼yk

Specyfika gry w kÃ³Å‚ko i krzyÅ¼yk jest taka, Å¼e pierwszy gracz ma zwykle wiÄ™cej do powiedzenia. W przypadku doÅ›wiadczonego pierwszego gracza drugi moÅ¼e doprowadziÄ‡ co najwyÅ¼ej do remisu. Nie ma moÅ¼liwoÅ›ci zmiany przebiegu rozgrywki bez bÅ‚Ä™du przeciwnika. Z drugiej strony, bÄ™dÄ…c pierwszym graczem, musimy wiedzieÄ‡, jak nie daÄ‡ zÅ‚apaÄ‡ siÄ™ w puÅ‚apki drugiego gracza, aby bezproblemowo wygraÄ‡.

Strategia optymalnej gry w kÃ³Å‚ko i krzyÅ¼yk znalazÅ‚a siÄ™ nie raz w zainteresowaniu naukowcÃ³w. To, co tutaj przedstawiÄ™, to strategia opisana przez Kevina Crowleya i Roberta S. Sieglera w 1993 r. (doi:[10.1016/0364-0213(93)90003-Q](https://doi.org/10.1016%2F0364-0213%2893%2990003-Q)). NaleÅ¼y jÄ… czytaÄ‡ w taki sposÃ³b, Å¼e staramy siÄ™ sprawdzaÄ‡ po kolei warunki kolejnych moÅ¼liwych ruchÃ³w, i gdy taki jest moÅ¼liwy, wykonujemy go. CaÅ‚oÅ›Ä‡ powtarzamy tak dÅ‚ugo, aÅ¼ ukoÅ„czymy grÄ™.

Strategia ta to tak naprawdÄ™ algorytm grania w kÃ³Å‚ko i krzyÅ¼yk. MoÅ¼esz go wprost zaimplementowaÄ‡ w swojej grze, aby mieÄ‡ bardzo prostÄ… sztucznÄ… inteligencjÄ™. Albo po prostu zapamiÄ™taÄ‡ i korzystaÄ‡ przy tradycyjnych rozgrywkach w kÃ³Å‚ko i krzyÅ¼yk.

### 1. Wygraj

**JeÅ¼eli:** jest wiersz, kolumna lub przekÄ…tna z dwoma moimi symbolami i puste miejsce,<br />
**Wtedy:** zagraj na pustym miejscu (i wygraj grÄ™).

<Image
  image={wygraj}
  alignCenter
  fullSize
  alt="Trzy plansze z grÄ… w kÃ³Å‚ko i krzyÅ¼yk prezentujÄ…ce jak wygraÄ‡ grÄ™."
  caption={<>
    Trzy sytuacje, w ktÃ³rych gracz X powinien zastosowaÄ‡ â€Wygrajâ€. Na zielono oznaczono ruch, ktÃ³ry powinno siÄ™ wykonaÄ‡, pozostaÅ‚e symbole juÅ¼ znajdowaÅ‚y siÄ™ wczeÅ›niej. O ile przypadki 1 i 2 sÄ… doÅ›Ä‡ oczywiste, to w przypadku 3 moÅ¼na rÃ³wnieÅ¼ blokowaÄ‡. WedÅ‚ug strategii zwyciÄ™stwo jest waÅ¼niejsze niÅ¼ blokowanie przeciwnika.
  </>}
/>

### 2. Zablokuj

**JeÅ¼eli:** jest wiersz, kolumna lub przekÄ…tna z dwoma symbolami mojego przeciwnika i puste miejsce,<br />
**Wtedy:** zagraj na pustym miejscu (tym samym blokujÄ…c potencjalne jego zwyciÄ™stwo).

<Image
  image={blokuj}
  alignCenter
  fullSize
  alt="Dwie plansze z grÄ… w kÃ³Å‚ko i krzyÅ¼yk prezentujÄ…ce jak blokowaÄ‡ wygranÄ… przeciwnika."
  caption={<>
    Dwie przykÅ‚adowe sytuacje, kiedy powinno siÄ™ blokowaÄ‡ potencjalnÄ… wygranÄ… przeciwnika.
  </>}
/>

### 3. ZrÃ³b rozgaÅ‚Ä™zienie

**JeÅ¼eli:** sÄ… dwa przecinajÄ…ce siÄ™ wiersze, kolumny lub przekÄ…tne z jednym moim symbolem i dwa puste miejsca oraz...<br />
**JeÅ¼eli:** miejsce przeciÄ™cia jest puste,<br />
**Wtedy:** przejdÅº do miejsca przeciÄ™cia (tym samym tworzÄ…c dwie moÅ¼liwoÅ›ci wygranej w nastÄ™pnym ruchu).

<Image
  image={rozgalezienie}
  alignCenter
  fullSize
  alt="Dwie plansze z grÄ… w kÃ³Å‚ko i krzyÅ¼yk prezentujÄ…ce jak wykonaÄ‡ rozgaÅ‚Ä™zienie"
  caption={<>
    Dwie przykÅ‚adowe sytuacje, kiedy powinniÅ›my zrobiÄ‡ rozgaÅ‚Ä™zienie. Na Å¼Ã³Å‚to oznaczone sÄ… przecinajÄ…ce siÄ™ wiersze, kolumny i przekÄ…tne. W pierwszym przypadku mamy przeciÄ™cie siÄ™ pierwszej kolumny i drugiego wiersza. W drugim przypadku przeciÄ™cie przekÄ…tnej z trzecim wierszem. DziÄ™ki wykonaniu takiego ruchu zapewniamy sobie zwyciÄ™stwo w grze.
  </>}
/>

### 4. ZrÃ³b blokujÄ…ce rozgaÅ‚Ä™zienie

**JeÅ¼eli:** sÄ… dwa przecinajÄ…ce siÄ™ wiersze, kolumny lub przekÄ…tne z jednym symbolem przeciwnika i dwa puste miejsca oraz...<br />
**JeÅ¼eli:** miejsce przeciÄ™cia jest puste,<br />
**Wtedy:**<br />
**JeÅ¼eli:** jest puste miejsce, ktÃ³re tworzy dwa symbole w rzÄ™dzie dla mnie (tym samym zmuszajÄ…c mojego przeciwnika do blokowania),<br />
**Wtedy:** przejdÅº do tego miejsca.<br />
**W przeciwnym wypadku:** przejdÅº do miejsca przeciÄ™cia (tym samym blokujÄ…c miejsce, gdzie przeciwnik mÃ³gÅ‚by zrobiÄ‡ rozgaÅ‚Ä™zienie).

<Image
  image={blokRozgalezienie}
  alignCenter
  fullSize
  alt="Dwie plansze z grÄ… w kÃ³Å‚ko i krzyÅ¼yk prezentujÄ…ce jak wykonaÄ‡ blokujÄ…ce rozgaÅ‚Ä™zienie"
  caption={<>
    Dwa przykÅ‚ady wykonania blokujÄ…cego rozgaÅ‚Ä™zienia. ZauwaÅ¼, Å¼e mamy tu zwykle kilka moÅ¼liwoÅ›ci ruchu. W pierwszym przypadku mamy moÅ¼liwoÅ›Ä‡ utworzenia dwÃ³ch swoich symboli z rzÄ™du przy jednoczesnym blokowaniu, stÄ…d preferujemy taki ruch. W drugim przypadku moÅ¼emy jedynie zablokowaÄ‡ potencjalne rozgaÅ‚Ä™zienie.
  </>}
/>

### 5. Zagraj Å›rodek

**JeÅ¼eli:** Å›rodek jest pusty,<br />
**Wtedy:** zagraj Å›rodek.

### 6. Zagraj przeciwny naroÅ¼nik

**JeÅ¼eli:** mÃ³j przeciwnik jest w naroÅ¼niku oraz...<br />
**JeÅ¼eli:** przeciwny naroÅ¼nik jest pusty,<br />
**Wtedy:** zagraj przeciwny naroÅ¼nik.

### 7. Zagraj pusty naroÅ¼nik

**JeÅ¼eli:** jest pusty naroÅ¼nik,<br />
**Wtedy:** przejdÅº do pustego naroÅ¼nika.

### 8. Zagraj pusty bok

**JeÅ¼eli:** jest pusty bok,<br />
**Wtedy:** przejdÅº na pusty bok.

### Sztuczna inteligencja?

JeÅ›li powyÅ¼sza strategia brzmi dla Ciebie jak typowe wydawanie rozkazÃ³w maszynie, to masz caÅ‚kowitÄ… racjÄ™. Do tego wÅ‚aÅ›nie sprowadza siÄ™ zaprogramowanie sztucznej inteligencji grajÄ…cej w kÃ³Å‚ko i krzyÅ¼yk â€” 8 warunkÃ³w (w praktyce nieco wiÄ™cej, gdyÅ¼ sprawdzamy rÃ³Å¼ne pozycje na planszy, ale jest to wciÄ…Å¼ 8 przypadkÃ³w). JeÅ›li kiedykolwiek spotkaÅ‚eÅ› siÄ™ z jakimÅ› Å¼artem, Å¼e jakaÅ› sztuczna inteligencja zapewne sprowadza siÄ™ do kilku warunkÃ³w, to cÃ³Å¼, wÅ‚aÅ›nie masz na to idealny przykÅ‚ad.

<Image
  image={win10}
  alignCenter
  fullSize
  maxWidth="348px"
  alt="Microsoft is using AI to make Windows 10 updates smoother -> `if (user.isDoingStuff() && user.hasUnsavedWork()) update()`"
  caption={<>
    â€Sztuczna inteligencjaâ€ w praktyce ğŸ™ƒ<br />
    (ÅºrÃ³dÅ‚o: <a href="https://www.reddit.com/r/ProgrammerHumor/comments/8rbmh9/ai_you_say/" target="_blank">https://www.reddit.com/r/ProgrammerHumor/comments/8rbmh9/ai_you_say/</a>)
  </>}
/>

Taki sposÃ³b tworzenia sztucznej inteligencji to, innymi sÅ‚owy, przeniesienie wiedzy eksperta na program komputerowy. Przy trudniejszych zastosowaniach nie zawsze siÄ™ to sprawdza, jednak byÅ‚o doÅ›Ä‡ powszechnym podejÅ›ciem w czasach przed popularyzacjÄ… uczenia maszynowego. Jest to podstawa tzw. systemÃ³w ekspertowych, czyli systemÃ³w, ktÃ³re operujÄ…c na wiedzy eksperckiej, sÄ… w stanie przeprowadziÄ‡ proces wnioskowania i wytÅ‚umaczyÄ‡ uÅ¼ytkownikowi, dlaczego zostaÅ‚a podjÄ™ta dana decyzja.

SwojÄ… drogÄ…, tworzÄ…c sztucznÄ… inteligencjÄ™ do gier, czÄ™sto robimy poziomy trudnoÅ›ci. W przypadku tej strategii moÅ¼emy tego dokonaÄ‡ bardzo prosto â€” wyrzucajÄ…c wybrane warianty ruchÃ³w. Moja propozycja jest taka, Å¼e dla poziomu Å‚atwego moÅ¼emy zrezygnowaÄ‡ z obu rodzajÃ³w rozgaÅ‚Ä™zieÅ„, natomiast dla Å›redniozaawansowanego wykorzystujemy tylko jedno z nich. SÄ… to najbardziej zaawansowane i czÄ™sto najmniej oczywiste ruchy, ktÃ³re pozwalajÄ… wygraÄ‡ grÄ™ bÄ…dÅº powstrzymaÄ‡ przeciwnika przed zwyciÄ™stwem. WÃ³wczas komputerowego gracza bÄ™dzie moÅ¼na pokonaÄ‡, a jednoczeÅ›nie nie bÄ™dzie on wykonywaÄ‡ ruchÃ³w wyglÄ…dajÄ…cych losowo.

### Implementacja w kodzie

Tutaj moÅ¼esz sprawdziÄ‡, jak ta strategia sprawdza siÄ™ w praktyce. Pod planszÄ… pokazane sÄ… komentarze opisujÄ…ce, jakÄ… decyzjÄ™ w danym momencie podejmuje gracz komputerowy:

<Iframe src="/iframe-content/tictactoe/winning-strategy/index.html" minHeight={450} />

Tak jak wspomniaÅ‚em wczeÅ›niej, kod ÅºrÃ³dÅ‚owy moÅ¼esz znaleÅºÄ‡ [na moim GitHubie](https://github.com/swistak-codes/tic-tac-toe/blob/main/winning-strategy/src/logic/computeComputerMove.js). Od razu ostrzegam, Å¼e kod jest doÅ›Ä‡ rozwlekÅ‚y, poniewaÅ¼ napisanie sprawdzania tych wszystkich warunkÃ³w wbrew pozorom zajmuje nieco miejsca. Mimo Å¼e kodu jest duÅ¼o, to jest jednak prosty i sprowadza siÄ™ do bardzo prostych operacji. Da siÄ™ go takÅ¼e uproÅ›ciÄ‡, ale napisaÅ‚em go w bardziej rozwlekÅ‚y sposÃ³b dla lepszego zobrazowania, co siÄ™ dzieje.

## Algorytm Minimax

PowyÅ¼sze podejÅ›cie dziaÅ‚a bardzo dobrze, jednak ma podstawowy problem â€” nie jest uniwersalne. ZostaÅ‚o opracowane po wnikliwej analizie konkretnej gry, toteÅ¼ nie da siÄ™ go przenieÅ›Ä‡ na dowolnÄ… innÄ… grÄ™, jak warcaby, szachy, czy nawet gomoku, ktÃ³re ma zasady bardzo zbliÅ¼one do kÃ³Å‚ka i krzyÅ¼yka. Dlatego teÅ¼ zobaczmy jeszcze jedno podejÅ›cie, ktÃ³re moÅ¼na zastosowaÄ‡ nie tylko w kÃ³Å‚ku i krzyÅ¼yk, ale teÅ¼ w wielu innych grach, czyli algorytm Minimax (zwany teÅ¼ min-max).

Zanim przejdziemy do jego omÃ³wienia, czas na nieco historii. Autorstwo algorytmu przypisuje siÄ™ Johnowi von Neumannowi (1928 r., [doi:10.1007/bf01448847](http://doi.org/10.1007/bf01448847)), jednak podobne pomysÅ‚y przedstawiali wczeÅ›niej Ã‰mile Borel (1921 r., [doi:10.2307/1906946](http://doi.org/10.2307/1906946) [tÅ‚umaczenie z 1953 r.]) i Charles Babbage (1844-1868). Co ciekawe, Charles Babbage opracowaÅ‚ podejÅ›cie podobne do Minimax przy opracowywaniu automatu do gry... w kÃ³Å‚ko i krzyÅ¼yk.

Jeszcze maÅ‚a, poboczna uwaga â€” algorytm opisujÄ™ na bazie pÃ³Åºniejszych opracowaÅ„, bo niestety oryginalna praca von Neumanna jest napisana po niemiecku, a nie znam na tyle dobrze tego jÄ™zyka, Å¼eby cokolwiek tam zrozumieÄ‡.

### Idea algorytmu

PomysÅ‚, jak ma dziaÅ‚aÄ‡ algorytm, jest zawarty w jego nazwie. Jest to strategia, gdzie po kolei rozpatrujemy moÅ¼liwoÅ›ci potoczenia siÄ™ gry tak, Å¼eby maksymalizowaÄ‡ zysk jednego gracza, a przy nastÄ™pnym ruchu minimalizowaÄ‡ zysk drugiego gracza. OczywiÅ›cie zakÅ‚ada siÄ™, Å¼e przeciwnik teÅ¼ bÄ™dzie chciaÅ‚ wykonaÄ‡ najlepszy moÅ¼liwy ruch, jaki moÅ¼e. Dlatego teÅ¼ rezultatem algorytmu powinien byÄ‡ taki ruch, ktÃ³ry zmusi przeciwnika do wykonania moÅ¼liwie najgorszego ruchu.

Jest to oczywiÅ›cie mocno uproszczona definicja, a jeÅ›li jesteÅ› bardziej zainteresowany(-a) tematem od strony teoretycznej, to warto poczytaÄ‡ o teorii gier, szczegÃ³lnie o grach o sumie zerowej i rÃ³wnowadze Nasha.

### Drzewo stanu gry

Aby mÃ³c obliczyÄ‡, jaki zestaw ruchÃ³w jest dla nas najlepszy, a jednoczeÅ›nie najgorszy dla przeciwnika, musimy wygenerowaÄ‡ wszelkie moÅ¼liwe stany planszy dostÄ™pne po kaÅ¼dym z ruchÃ³w. W zaleÅ¼noÅ›ci od tego, jaki ruch wykonamy w aktualnej turze, inne ruchy sÄ… dostÄ™pne dla przeciwnika w kolejnej. Od tego, ktÃ³ry ruch wykona przeciwnik, zaleÅ¼y, jakie ruchy my moÅ¼emy dalej wykonaÄ‡. Tworzy to strukturÄ™ zwanÄ… drzewem stanu gry.

Czym sÄ… drzewa w informatyce, omawiaÅ‚em przy okazji <Link href="/post/sortowanie-cz-4-sortowanie-przez-wybieranie">sortowania przez wybieranie</Link>, i bardzo zachÄ™cam do przeczytania tam o teorii, jeÅ›li spotykasz siÄ™ z tym pojÄ™ciem po raz pierwszy.

W naszym drzewie stanu gry, jak wspomniaÅ‚em wczeÅ›niej, kaÅ¼dy wÄ™zeÅ‚ bÄ™dzie stanem planszy w danym momencie. Potomkami takiego wÄ™zÅ‚a bÄ™dÄ… kolejne ruchy, jakie mogÄ… zostaÄ‡ wykonane po tym ruchu. Innymi sÅ‚owy, bÄ™dziemy musieli wygenerowaÄ‡ wszystkie moÅ¼liwe stany gry, aby algorytm mÃ³gÅ‚ wybraÄ‡ najlepszy ruch. Jak siÄ™ moÅ¼esz domyÅ›laÄ‡, nie jest to idealne podejÅ›cie. O ile w przypadku tak prostej gry, jak kÃ³Å‚ko i krzyÅ¼yk, uda siÄ™ to zrobiÄ‡ w rozsÄ…dnym czasie, o tyle w bardziej zaawansowanych grach, jak np. szachy, jest to niewykonalne, stÄ…d stosuje siÄ™ powszechnie rÃ³Å¼ne heurystyki upraszczajÄ…ce drzewo. CzÄ™Å›Ä‡ z nich doczekaÅ‚a siÄ™ opisania jako oddzielne algorytmy, o czym opowiadam pÃ³Åºniej.

<Image
  image={kolkoKrzyzyk}
  alignCenter
  fullSize
  alt="Krok 1: 2, 5, 7, 9, 8, 10. PorÃ³wnanie: 2 < 5. Krok 2: 2, 5, 7, 9, 8, 10. PorÃ³wnanie: 5 < 7. Krok 3: 2, 5, 7, 9, 8, 10. PorÃ³wnanie: 7 < 9. Krok 4: 2, 5, 7, 9, 8, 10. PorÃ³wnanie: 9 > 8."
  caption={<>
    Tak wyglÄ…da peÅ‚ne drzewo gry w kÃ³Å‚ko i krzyÅ¼yk dla gracza X. Dla uproszczenia autor tego diagramu poÅ‚Ä…czyÅ‚ ze sobÄ… identyczne gaÅ‚Ä™zie, stÄ…d struktura na rysunku tak naprawdÄ™ nie jest drzewem. Aczkolwiek sens jest zachowany. Do tego drzewo jest doÅ›Ä‡ maÅ‚e, poniewaÅ¼ wyeliminowano z niego symetryczne warianty ruchÃ³w prowadzÄ…ce do takich samych sytuacji.<br />
    (ÅºrÃ³dÅ‚o: By Mike like0708 - Own work, CC0, <a href="https://commons.wikimedia.org/w/index.php?curid=98793312" target="_blank">https://commons.wikimedia.org/w/index.php?curid=98793312</a>)
  </>}
/>

### OgÃ³lny zarys algorytmu

Minimax opiera siÄ™ na przeszukiwaniu drzewa w gÅ‚Ä…b, co oznacza, Å¼e jest algorytmem rekurencyjnym. W podejÅ›ciach tego typu zaczynamy od korzenia drzewa, skÄ…d schodzimy w dÃ³Å‚, aby potem wracaÄ‡ do gÃ³ry.

W przypadku Minimax schodzimy w dÃ³Å‚ do koÅ„cowych stanÃ³w gry (czyli liÅ›ci drzewa), albo do maksymalnej gÅ‚Ä™bokoÅ›ci, jakÄ… chcemy sprawdzaÄ‡. OkreÅ›lamy tam wynik gry z perspektywy naszego, komputerowego gracza. PrzyjÄ™Å‚o siÄ™ stosowaÄ‡ $$+\infty$$ dla wygranej i $$-\infty$$ dla przegranej, jednak nie jest to przymus stosowaÄ‡ takie wartoÅ›ci. WaÅ¼ne tylko, aby wartoÅ›ci byÅ‚y okreÅ›lane w taki sposÃ³b, Å¼e najlepiej oddadzÄ… aktualny stan planszy.

WracajÄ…c do gÃ³ry, zbieramy wartoÅ›ci ze wszystkich potomnych stanÃ³w gry i wybieramy minimum bÄ…dÅº maksimum. Maksimum wybieramy dla naszego gracza, minimum dla przeciwnika. Ostatecznie dochodzimy z powrotem do korzenia drzewa i wybieramy ten ruch, dla ktÃ³rego zostaÅ‚a zwrÃ³cona najwiÄ™ksza wartoÅ›Ä‡. Zobrazowanie dziaÅ‚ania algorytmu moÅ¼esz zobaczyÄ‡ na poniÅ¼szym schemacie:

<Image
  image={minimax}
  alignCenter
  fullSize
  alt="Schemat wykonania algorytmu Minimax"
  caption={<>
    Prezentacja dziaÅ‚ania algorytmu Minimax. Na pomaraÅ„czowo pokazano, ktÃ³re wartoÅ›ci przechodzÄ… do wÄ™zÅ‚a rodzica, a na zielono najlepszÄ… dostÄ™pnÄ… Å›cieÅ¼kÄ™. Tym samym naszym kolejnym ruchem bÄ™dzie utworzenie takiego stanu gry, jaki wskazuje nam zielona krawÄ™dÅº na poziomie pierwszym.
  </>}
/>

### Implementacja w kÃ³Å‚ko i krzyÅ¼yk

W przypadku gry w kÃ³Å‚ko i krzyÅ¼yk, jak wspomniaÅ‚em wczeÅ›niej, nie musimy martwiÄ‡ siÄ™ o wydajnoÅ›Ä‡ algorytmu, wiÄ™c moÅ¼emy spokojnie przeprowadziÄ‡ go w peÅ‚ni, czyli do koÅ„cowego stanu gry. Natomiast w kwestii programisty pozostaje wybÃ³r wartoÅ›ci. MoÅ¼emy podejÅ›Ä‡ do tego, wykorzystujÄ…c tylko trzy wartoÅ›ci â€” nieskoÅ„czonoÅ›ci dla wygranej i przegranej, a zero dla remisu. MoÅ¼na teÅ¼ pomyÅ›leÄ‡ nad innym ustawianiem wartoÅ›ci, ktÃ³re bÄ™dzie premiowaÄ‡ szybsze wygrane, jednak w praktyce bÄ™dzie to mieÄ‡ znaczenie tylko w przypadku, gdy zaczyna komputerowy gracz.

Dla uÅ‚atwienia ja w swojej implementacji podszedÅ‚em do tematu, wykorzystujÄ…c tylko trzy wartoÅ›ci, poniewaÅ¼ dla drugiego gracza, ktÃ³ry siÄ™ broni, nie ma to wiÄ™kszego znaczenia. PoniÅ¼ej moÅ¼esz zobaczyÄ‡, jak sprawdza siÄ™ to w praktyce:

<Iframe src="/iframe-content/tictactoe/minimax/index.html" minHeight={450} />

Tak jak w poprzednim przypadku, kod ÅºrÃ³dÅ‚owy moÅ¼esz znaleÅºÄ‡ [na moim GitHubie](https://github.com/swistak-codes/tic-tac-toe/blob/main/minimax/src/logic/computeComputerMove.js). ZwrÃ³Ä‡ uwagÄ™, Å¼e kod jest o wiele prostszy i dosÅ‚ownie jedyne miejsce, gdzie zawiera logikÄ™ gry, to sprawdzenie, kto wygrywa. OczywiÅ›cie w trudniejszych grach przy generowaniu ruchÃ³w trzeba by sprawdzaÄ‡, czy dany ruch jest moÅ¼liwy; tu jednak wystarczy jedynie sprawdzenie, czy pole jest puste.

## Inne podejÅ›cia

Algorytm Minimax nie jest bez wad. Przede wszystkim nie naleÅ¼y do najszybszych sposobÃ³w. Wygenerowanie drzewa ze wszystkimi moÅ¼liwoÅ›ciami rozgrywki jest kosztowne, szczegÃ³lnie w grach o bardziej skomplikowanych zasadach czy wiÄ™kszych planszach niÅ¼ kÃ³Å‚ko i krzyÅ¼yk. Z tego teÅ¼ powodu opracowano inne algorytmy bazujÄ…ce na podobnej idei, jednak wykonujÄ…ce siÄ™ szybciej:

- Najbardziej znanÄ… alternatywÄ… dla Minimax jest algorytm alfa-beta. Jest to na dobrÄ… sprawÄ™ poprawiony Minimax w tym sensie, Å¼e nie sprawdzamy wszystkich rozgaÅ‚Ä™zieÅ„ drzewa stanu gry. Odcinamy te, ktÃ³re sÄ… dla nas najmniej korzystne (stÄ…d alternatywna nazwa â€” algorytm odciÄ™Ä‡ alfa-beta) i sprawdzamy tylko te najlepsze gaÅ‚Ä™zie.
- IstniejÄ… jeszcze inne modyfikacje algorytmu Minimax, takie jak: NegaScout, Negamax, Expectiminimax.
- Wszystkie wymienione wyÅ¼ej algorytmy dziaÅ‚ajÄ… na zasadzie wyszukiwania w gÅ‚Ä…b. SÄ… jednak rÃ³wnieÅ¼ algorytmy typu Best-First, gdzie wyszukiwanie odbywa siÄ™ podobnie do wyszukiwania wszerz, jednak z naciskiem na eksploracjÄ™ najlepiej zapowiadajÄ…cych siÄ™ rozgaÅ‚Ä™zieÅ„. MoÅ¼emy tu wyrÃ³Å¼niÄ‡ takie algorytmy, jak B*, SSS*, Monte-Carlo Tree Search czy Best-First Minimax Search.
- W przypadku kÃ³Å‚ka i krzyÅ¼yka jest to oczywiÅ›cie przesada, ale dla bardziej rozbudowanych gier moÅ¼na zastosowaÄ‡ techniki gÅ‚Ä™bokiego uczenia, w szczegÃ³lnoÅ›ci sieci neuronowe. W tej dziedzinie zdecydowanie najbardziej znany jest projekt Alpha Zero od Google'a. Wykorzystuje on poÅ‚Ä…czenie gÅ‚Ä™boko uczÄ…cych siÄ™ sieci neuronowych i przeszukiwania Monte-Carlo Tree Search. JeÅ›li jesteÅ› ciekaw(a), jak w tym podejÅ›ciu wyglÄ…da kÃ³Å‚ko i krzyÅ¼yk, to udaÅ‚o mi siÄ™ znaleÅºÄ‡ dziaÅ‚ajÄ…cy przykÅ‚ad na [GitHubie](https://github.com/grimmer0125/alphago-zero-tictactoe-js).

## Literatura

- Bottomley H., *How many Tic-Tac-Toe (noughts and crosses) games are possible?*, [http://www.se16.info/hgb/tictactoe.htm](http://www.se16.info/hgb/tictactoe.htm) (ostatnie odwiedziny: 23.08.2021).
- Crowley, K. and Siegler, R.S. (1993), Flexible Strategy Use in Young Children's Tic-Tac-Toe. Cognitive Science, 17: 531-561. [https://doi.org/10.1207/s15516709cog1704_3](https://doi.org/10.1207/s15516709cog1704_3)
- Minimax: [https://www.chessprogramming.org/index.php?title=Minimax&oldid=24142](https://www.chessprogramming.org/index.php?title=Minimax&oldid=24142) (ostatnie odwiedziny: 23.08.2021).
- Monnens, D. (2013). " I commenced an examination of a game called'tit-tat-to'": Charles Babbage and the" First" Computer Game. In *DiGRA Conference*.
- Leyton-Brown K., Shoham Y., â€Further Solution Concepts for Normal-Form Gamesâ€ w *Essentials of Game Theory: A Concise Multidisciplinary Introduction*. Morgan & Claypool, 2008, s. 15-31. [https://doi.org/10.2200/S00108ED1V01Y200802AIM003](https://doi.org/10.2200/S00108ED1V01Y200802AIM003)
- Search: [https://www.chessprogramming.org/index.php?title=Search&oldid=24558](https://www.chessprogramming.org/index.php?title=Search&oldid=24558) (ostatnie odwiedziny: 23.08.2021).

<small>(obrazek na okÅ‚adce to kolaÅ¼ obrazkÃ³w wygenerowanych przez sieÄ‡ neuronowÄ… VQGAN+CLIP po zadaniu jej rÃ³Å¼nych kombinacji haseÅ‚ â€animalsâ€ oraz â€tic-tac-toeâ€; ÅºrÃ³dÅ‚o obrazka na froncie: [https://commons.wikimedia.org/wiki/File:Tic_tac_toe.svg](https://commons.wikimedia.org/wiki/File:Tic_tac_toe.svg))</small>
