import Link from 'next/link';
import {Image} from '@swistak-codes/components';
import {Presentation} from './presentation';
import cover from './swistaki_zegar.jpg';
import pyFinal from './py-final.png';
import jsFinal from './js-final.png';
import drawBorder from './draw-border.png';
import zegarKola from './zegar_kola.png';
import zegarKaty from './zegar_katy.png';
import okragTrojkat from './okrag-trojkat.png';
import trojkat from './trojkat.png';
import zegarWskazowki from './zegar_wskazowki.png';

export const meta = {
  title: 'Jak narysowaÄ‡ zegar analogowy?',
  abstract:
    'W artykule omawiam, w jaki sposÃ³b, stosujÄ…c prostÄ… matematykÄ™, moÅ¼emy stworzyÄ‡ animacjÄ™ zegara analogowego.',
  firstParagraph: (
    <>
      Do tej pory na blogu przedstawiaÅ‚em przede wszystkim gotowe i znane rozwiÄ…zania algorytmiczne, ale rzadko pokazywaÅ‚em, jak od podstaw coÅ› zrobiÄ‡, czego nie znajdziemy w podrÄ™cznikach do algorytmiki. Za to moÅ¼emy znaleÅºÄ‡ w podrÄ™cznikach do informatyki. PokaÅ¼Ä™ w tym wpisie, w jaki sposÃ³b, wykorzystujÄ…c prostÄ… matematykÄ™, zrobiÄ‡ coÅ›, co dziaÅ‚a i wyÅ›wietla wiÄ™cej niÅ¼ ciÄ…gi liczb. A dokÅ‚adniej â€” stworzymy prosty, animowany zegar analogowy.
    </>
  ),
  keyword: 'zegar analogowy',
  categories: ['Data i czas', 'Matematyka', 'Programowanie', 'Grafika komputerowa'],
  tags: [
    'javascript',
    'canvas',
    'rysowanie',
    'grafika komputerowa',
    'geometria',
    'trygonometria',
    'czas'
  ],
  slug: 'jak-narysowac-zegar-analogowy',
  updateTime: '2023-02-08T07:00:00+00:00',
  publishTime: '2023-02-08T07:00:00+00:00',
  cover,
  moveCoverToTop: true,
};

## Zegar analogowy z punktu widzenia matematyki

Nie bÄ™dÄ™ opisywaÄ‡, jak dziaÅ‚a zegar analogowy ani jak go odczytywaÄ‡. To, na czym siÄ™ skupimy, to jak go potraktowaÄ‡ od strony matematycznej tak, byÅ›my byli w stanie narysowaÄ‡ go za pomocÄ… dowolnego jÄ™zyka programowania (obsÅ‚ugujÄ…cego rysowanie po ekranie).

Przede wszystkim zegar analogowy musimy widzieÄ‡ jako kilka kÃ³Å‚ ze wspÃ³lnym Å›rodkiem. KaÅ¼da ze wskazÃ³wek, pokazujÄ…c czas, wyznacza okrÄ…g o innym promieniu. MoÅ¼emy to sobie zobrazowaÄ‡ w poniÅ¼szy sposÃ³b:

<Image
  image={zegarKola}
  alignCenter
  fullSize
  forceWhiteBackground={false}
  maxWidth="500px"
  alt="Zegar analogowy z dwoma wskazÃ³wkami â€” godzinowÄ… i minutowÄ…. Narysowane sÄ… dodatkowo okrÄ™gi wyznaczane przez ruch kaÅ¼dej ze wskazÃ³wek."
  caption={<>Kolorem granatowym zaznaczyÅ‚em okrÄ…g wyznaczany przez wskazÃ³wkÄ™ minutowÄ…, a na zielono przez godzinowÄ….
    <br/>(oryginalny rysunek: <a href="https://commons.wikimedia.org/wiki/File:ClockIcon.svg">ClkerFreeVectorImages</a>, CC0, via Wikimedia Commons)</>}
/>

Skoro kaÅ¼da ze wskazÃ³wek wyznacza okrÄ…g, oznacza to, Å¼e jej aktualne wskazanie moÅ¼emy traktowaÄ‡ jako wyznaczenie Å‚uku okrÄ™gu. Inaczej to ujmujÄ…c, wyobraÅº sobie wirtualnÄ… wskazÃ³wkÄ™, ktÃ³ra zawsze pokazuje godzinÄ™ 12. Wskazanie kaÅ¼dej kolejnej ze wskazÃ³wek zamiast jako czas moÅ¼emy traktowaÄ‡ jako kÄ…t Å›rodkowy Å‚uku, mniej wiÄ™cej tak, jak na poniÅ¼szym rysunku:

<Image
  image={zegarKaty}
  alignCenter
  fullSize
  forceWhiteBackground={false}
  maxWidth="500px"
  alt="Zegar analogowy z dwoma wskazÃ³wkami â€” godzinowÄ… i minutowÄ…. Dodatkowo narysowano czerwonÄ… wskazÃ³wkÄ™ wskazujÄ…cÄ… godzinÄ™ dwunastÄ…. MiÄ™dzy dodatkowÄ… wskazÃ³wkÄ… a dwoma pozostaÅ‚ymi wyznaczono kÄ…ty."
  caption={<>Na czerwono dorysowaÅ‚em wirtualnÄ… wskazÃ³wkÄ™ wyznaczajÄ…cÄ… godzinÄ™ 12. Na niebiesko zaznaczyÅ‚em kÄ…t wyznaczony miÄ™dzy niÄ… a wskazÃ³wkÄ… minutowÄ…, a na zielono kÄ…t do wskazÃ³wki godzinowej.
    <br/>(oryginalny rysunek: <a href="https://commons.wikimedia.org/wiki/File:ClockIcon.svg">ClkerFreeVectorImages</a>, CC0, via Wikimedia Commons)</>}
/>

Dobrze, ale co nam to daje? OtÃ³Å¼ znajÄ…c kÄ…t Å›rodkowy Å‚uku i promieÅ„ koÅ‚a, jesteÅ›my w stanie obliczyÄ‡ wspÃ³Å‚rzÄ™dne punktu (w kartezjaÅ„skim ukÅ‚adnie wspÃ³Å‚rzÄ™dnych) na okrÄ™gu, w ktÃ³rym dany Å‚uk siÄ™ koÅ„czy. Innymi sÅ‚owy, dokÅ‚adnie ten punkt, ktÃ³ry wskazuje wskazÃ³wka. WzÃ³r na to prawdopodobnie znajduje siÄ™ w szkolnych kartach wzorÃ³w, ale moÅ¼emy go wyznaczyÄ‡ prostÄ… trygonometriÄ…. Zwizualizujmy sobie najpierw to, zapominajÄ…c na chwilÄ™ o zegarze, a pamiÄ™tajÄ…c jedynie o kole.

<Image
  image={okragTrojkat}
  alignCenter
  fullSize
  maxWidth="500px"
  alt="OkrÄ…g w kartezjaÅ„skim ukÅ‚adzie wspÃ³Å‚rzÄ™dnych z narysowanym trÃ³jkÄ…tem, ktÃ³ry ma wspÃ³lny kÄ…t z koÅ‚em w punkcie miÄ™dzy 7 a 8 minutÄ… na tarczy zegara."
  caption={<>OkrÄ…g o promieniu 1 oraz trÃ³jkÄ…t prostokÄ…tny majÄ…cy jeden punkt wspÃ³lny z koÅ‚em.
    <br/>(wygenerowano z uÅ¼yciem desmos.com)</>}
/>

W tym momencie nawet nie musimy znaÄ‡ rÃ³wnania okrÄ™gu ($$x^2-y^2=r^2$$, gdyby ktoÅ› nie pamiÄ™taÅ‚). Jedyne, co nas interesuje, to narysowany przeze mnie trÃ³jkÄ…t prostokÄ…tny. Znamy dÅ‚ugoÅ›Ä‡ przeciwprostokÄ…tnej, bo jest to promieÅ„ koÅ‚a. Znamy teÅ¼ jeden z kÄ…tÃ³w. Innymi sÅ‚owy, mamy wszystkie informacje potrzebne do znalezienia przyprostokÄ…tnych, ktÃ³re wyznaczÄ… nam punkt na okrÄ™gu.

<Image
  image={trojkat}
  alignCenter
  fullSize
  maxWidth="300px"
  alt="TrÃ³jkÄ…t prostokÄ…tny z zaznaczonym kÄ…tem alfa (po lewej stronie na dole) oraz zaznaczonym kÄ…tem prostym (po prawej stronie na dole). PrzeciwprostokÄ…tna jest opisana jako r, pozioma przyprostokÄ…tna jako x, pionowa przyprostokÄ…tna jako y."
  caption={<></>}
/>

Aby wyznaczyÄ‡ przyprostokÄ…tnÄ…, ktÃ³ra da pozycjÄ™ na osi OX (zakÅ‚adajÄ…c Å›rodek koÅ‚a w punkcie $$(0,0)$$), wykorzystamy poniÅ¼szy wzÃ³r:

$$
\begin{align*}
\cos \alpha &= \frac{x}{r} \\
x &= r \cdot \cos \alpha
\end{align*}
$$

A jak wyznaczyÄ‡ pozycjÄ™ na osi OY? Analogicznie, czyli wykorzystujÄ…c inny wzÃ³r trygonometryczny:

$$
\begin{align*}
\sin \alpha &= \frac{y}{r} \\
y &= r \cdot \sin \alpha
\end{align*}
$$

## Przygotowanie Å›rodowiska programistycznego

UÅ¼ycie tych wzorÃ³w w praktyce zaprezentujÄ™ na przykÅ‚adzie jÄ™zyka programowania JavaScript (przeglÄ…darkowego). Aczkolwiek na samym koÅ„cu, dla chÄ™tnych, pokaÅ¼Ä™ takÅ¼e przeniesienie dokÅ‚adnie tego samego kodu na Python (z [pygame](https://www.pygame.org/news)).

Teraz w artykule opiszÄ™ krok po kroku, jak stworzyÄ‡ rÃ³Å¼ne elementy skÅ‚adajÄ…ce siÄ™ na zegar analogowy. CaÅ‚oÅ›Ä‡ mojej implementacji zamieszczÄ™ rÃ³wnieÅ¼ na koÅ„cu artykuÅ‚u, w wersji umoÅ¼liwiajÄ…cej interaktywne przerabianie kodu.

SkoÅ„czona aplikacja w JavaScript bÄ™dzie wyglÄ…daÄ‡ nastÄ™pujÄ…co:

<Image
  image={jsFinal}
  alignCenter
  fullSize
  maxWidth="500px"
  alt="Rysunek zegara analogowego."
  caption={<></>}
/>

A w Pythonie:

<Image
  image={pyFinal}
  alignCenter
  fullSize
  maxWidth="500px"
  alt="Rysunek zegara analogowego."
  caption={<></>}
/>

### Baza do tworzenia kodu

W tym przypadku tak naprawdÄ™ jedyne, co potrzebujemy, to stworzyÄ‡ plik HTML zawierajÄ…cy element typu `<canvas>` (pÅ‚Ã³tno) oraz pusty plik ze skryptem JS (np. `script.js`) do uÅ¼ycia w pliku HTML. MoÅ¼e to wyglÄ…daÄ‡ nastÄ™pujÄ…co:

```html
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Zegar analogowy</title>
</head>

<body>
  <canvas id="canvas" width="500" height="500">
    Twoja przeglÄ…darka nie wspiera Canvas
  </canvas>
  <script src="script.js"></script>
</body>

</html>
```

JeÅ›li nigdy nic nie pisaÅ‚eÅ›(-aÅ›) w postaci strony internetowej, zamiast tworzyÄ‡ wszystko na swoim komputerze, proÅ›ciej moÅ¼e byÄ‡ Ci skorzystaÄ‡ z serwisu typu [CodePen](https://codepen.io/), gdzie moÅ¼na szybko stworzyÄ‡ Å›rodowisko przystosowane pod pisanie HTML, CSS i JavaScript. WÃ³wczas na nasze potrzeby wystarczy, Å¼e w czÄ™Å›ci HTML utworzysz jedynie element typu `<canvas>` i zaczniesz od razu pisaÄ‡ kod w JavaScript. Innymi alternatywami sÄ… np. [CodeSandbox](https://codesandbox.io) (z wykorzystaniem szablonu *Vanilla JavaScript*) lub [repl.it](https://replit.com/) (z szablonem *HTML, CSS, JS*). IstniejÄ… teÅ¼ inne serwisy, ale te trzy mogÄ™ z caÅ‚Ä… pewnoÅ›ciÄ… poleciÄ‡.

### Przygotowanie do rysowania animacji

Aby przygotowaÄ‡ siÄ™ do rysowania po pÅ‚Ã³tnie, musimy wyciÄ…gnÄ…Ä‡ je z HTML-a i dostaÄ‡ siÄ™ do jego kontekstu rysowania 2D. JeÅ›li `<canvas>` zostaÅ‚ zdefiniowany w HTML-u tak jak powyÅ¼ej, moÅ¼na to zrobiÄ‡ poniÅ¼szym kodem JS:

```javascript
const canvas = document.getElementById("canvas");
const context = canvas.getContext("2d");
```

Zdefiniujmy od razu funkcjÄ™ czyszczÄ…cÄ… ekran:

```javascript
const clear = () => {
  context.clearRect(0, 0, canvas.width, canvas.height);
};
```

Teraz moÅ¼emy przejÅ›Ä‡ do samej pÄ™tli rysujÄ…cej animacjÄ™. W JavaScript najproÅ›ciej jest zrobiÄ‡ funkcjÄ™, ktÃ³ra wywoÅ‚a siÄ™ rekurencyjnie po okreÅ›lonym czasie. Z racji tego, Å¼e chcemy pÅ‚ynnÄ… animacjÄ™, najlepiej do tego wykorzystaÄ‡ `window.requestAnimationFrame`, ktÃ³re wykona wskazanÄ… funkcjÄ™ w nastÄ™pnym oknie rysowania (czyli np. przy odÅ›wieÅ¼aniu ekranu 60 Hz, po 16,6 milisekundach). Skoro aktualnie mamy tylko czyszczenie ekranu, wrzuÄ‡my je tam. BÄ™dzie to wyglÄ…daÄ‡ nastÄ™pujÄ…co:

```javascript
const draw = () => {
  clear();

  window.requestAnimationFrame(() => {
    draw();
  });
}

draw();
```

Na koÅ„cu oczywiÅ›cie wywoÅ‚ujemy `draw()`, aby zainicjowaÄ‡ pÄ™tlÄ™. JesteÅ›my teraz gotowi do uzupeÅ‚nienia tej funkcji o kod rysujÄ…cy zegar.

## Ustalenie staÅ‚ych i narysowanie obramowania tarczy

Zanim przejdziemy do wÅ‚aÅ›ciwego wykorzystania pokazanej wczeÅ›niej wiedzy matematycznej, najpierw narysujmy obramowanie tarczy zegara, przy okazji ustawiajÄ…c parÄ™ rzeczy i tÅ‚umaczÄ…c, jak dziaÅ‚a rysowanie w JavaScript.

### Ustawienie staÅ‚ych

Najpierw ustawmy staÅ‚Ä…, w ktÃ³rej przechowamy promieÅ„ caÅ‚ego zegara. Ja jako promieÅ„ przyjÄ…Å‚em 250 pikseli (i tak rozmiar pÅ‚Ã³tna w HTML-u ustawiÅ‚em 500Ã—500, wiÄ™c wiÄ™kszego nie daÅ‚bym rady).

```javascript
const OUTER_RADIUS = 250;
```

Przy okazji moÅ¼emy ustawiÄ‡ rÃ³wnieÅ¼ promienie okrÄ™gÃ³w wyznaczanych przez kaÅ¼dÄ… ze wskazÃ³wek. Zawsze najkrÃ³tsza jest godzinowa, a dÅ‚uÅ¼sza od niej minutowa. SekundowÄ… rozrÃ³Å¼nia siÄ™ przede wszystkim kolorem, natomiast co do dÅ‚ugoÅ›ci nie wiem, czy jest reguÅ‚a. Ja ustawiÅ‚em u siebie, Å¼e bÄ™dzie najdÅ‚uÅ¼sza:

```javascript
const SECOND_RADIUS = 200;
const MINUTE_RADIUS = 180;
const HOUR_RADIUS = 120;
```

NastÄ™pnymi przydatnymi dla nas wartoÅ›ciami bÄ™dÄ… wspÃ³Å‚rzÄ™dne Å›rodka naszego pÅ‚Ã³tna. MoÅ¼emy oczywiÅ›cie wpisaÄ‡ w ciemno $$(250, 250)$$, skoro wiemy, Å¼e ustawiliÅ›my wymiary 500Ã—500, ale lepszym podejÅ›ciem jest wyciÄ…gnÄ…Ä‡ te wymiary i podzieliÄ‡ przez dwa:

```javascript
const centerX = canvas.width / 2;
const centerY = canvas.height / 2;
```

### Narysowanie okrÄ™gu

Zdefiniujmy wreszcie funkcjÄ™ rysujÄ…cÄ… okrÄ…g stanowiÄ…cy ramkÄ™ zegara. WyrÃ³Å¼niam ten etap gÅ‚Ã³wnie dlatego, Å¼e wskaÅ¼e nam, jak wyglÄ…da rysowanie w JavaScript oraz jak moÅ¼emy nim sterowaÄ‡. Najpierw pokaÅ¼Ä™ implementacjÄ™ funkcji, a potem jÄ… wyjaÅ›niÄ™:

```javascript
const drawBorder = () => {
  context.beginPath();
  context.strokeStyle = "black";
  context.arc(centerX, centerY, OUTER_RADIUS, 0, 2 * Math.PI);
  context.stroke();
};
```

IdÄ…c po kolei:

- Rysowanie inicjujemy funkcjÄ… `beginPath()`. Wskazujemy w ten sposÃ³b kontekstowi rysujÄ…cemu, Å¼e zaczynamy nowÄ… figurÄ™, ktÃ³ra bÄ™dzie mieÄ‡ wspÃ³lne ustawienia rysowania, takie jak kontur czy wypeÅ‚nienie.
- `strokeStyle` ustawia kolor konturu.
- W JavaScript nie ma funkcji dedykowanej rysowaniu okrÄ™gÃ³w, ale moÅ¼emy to wykonaÄ‡ przy uÅ¼yciu `arc()`. Jest to funkcja rysujÄ…ca Å‚uk. Dwoma pierwszymi argumentami sÄ… wspÃ³Å‚rzÄ™dne Å›rodka, nastÄ™pnie wskazujemy promieÅ„ koÅ‚a, na ktÃ³rym wyznaczamy Å‚uk. Kolejne dwa argumenty to wartoÅ›ci w radianach: kÄ…ta, od ktÃ³rego zaczynamy rysowanie Å‚uku i na ktÃ³rym koÅ„czymy. JeÅ›li chcemy narysowaÄ‡ caÅ‚y okrÄ…g, oczywiÅ›cie zaczynamy od 0 radianÃ³w, a koÅ„czymy na $$2\pi$$ radianach ($$360^{\circ}$$).
- `stroke()` wywoÅ‚uje narysowanie wskazanej Å›cieÅ¼ki z okreÅ›lonym wczeÅ›niej konturem.

ZapamiÄ™tajmy te rzeczy, bo wszystko to (z wyjÄ…tkiem `arc()`) bÄ™dziemy uÅ¼ywaÄ‡ caÅ‚y czas â€” wÅ‚aÅ›nie tak definiuje siÄ™ rysowanie jakichkolwiek figur w JavaScript.

MoÅ¼emy teraz dodaÄ‡ funkcjÄ™ rysujÄ…cÄ… ramkÄ™ do `draw()`, tym samym otrzymujÄ…c poniÅ¼szy kod:

```javascript
const draw = () => {
  clear();
  drawBorder();

  window.requestAnimationFrame(() => {
    draw();
  });
};
```

Wizualnie bÄ™dzie to wyglÄ…daÄ‡ nastÄ™pujÄ…co:

<Image
  image={drawBorder}
  alignCenter
  fullSize
  maxWidth="500px"
  alt="Czarny okrÄ…g na biaÅ‚ym tle"
  caption={<></>}
/>

MoÅ¼e nic ciekawego, ale wÅ‚aÅ›nie pomyÅ›lnie narysowaÅ‚eÅ›(-aÅ›) okrÄ…g w JavaScript.

## Rysowanie wskazÃ³wek

PrzejdÅºmy teraz do rysowania wskazÃ³wek. Aby siÄ™ nie powtarzaÄ‡, zrobimy wspÃ³lny kod rysujÄ…cy dla wszystkich trzech wskazÃ³wek, a takÅ¼e napiszemy oddzielnie funkcjÄ™ wyznaczajÄ…cÄ… pozycjÄ™ punktu na okrÄ™gu (przyda siÄ™ przy wielu innych okazjach niÅ¼ tylko narysowanie wskazÃ³wek).

### Funkcja okreÅ›lajÄ…ca poÅ‚oÅ¼enie punktu na okrÄ™gu

Jak pamiÄ™tasz z poczÄ…tku artykuÅ‚u, pozycjÄ™ na okrÄ™gu moÅ¼emy wyznaczyÄ‡ z nastÄ™pujÄ…cych wzorÃ³w:

$$
\begin{align*}
x &= r \cdot \cos \alpha \\
y &= r \cdot \sin \alpha
\end{align*}
$$

Tak wiÄ™c czy coÅ› jeszcze potrzebujemy dodatkowo zrobiÄ‡? W zasadzie tak. Spowodowane jest to dwiema rzeczami:

- WedÅ‚ug wzoru Å›rodek okrÄ™gu jest w punkcie $$(0,0)$$ wiÄ™c musimy go przesunÄ…Ä‡ odpowiednio w przestrzeni.
- Natomiast kÄ…t $$0^{\circ}$$ znajduje siÄ™ â€na osiâ€ OX, podczas gdy na zegarze znajduje siÄ™ na OY.

W kwestii pierwszego problemu rozwiÄ…zaniem jest po prostu dodanie wspÃ³Å‚rzÄ™dnych Å›rodka pÅ‚Ã³tna. Natomiast w przypadku drugiego musimy kÄ…t â€przesunÄ…Ä‡â€ o $$90^{\circ}$$ ($$\frac{1}{2}\pi$$ radianÃ³w). KÄ…t ten oczywiÅ›cie odejmujemy, aby przesunÄ…Ä‡ wszystkie wartoÅ›ci przeciwnie do (nomen omen) ruchu wskazÃ³wek zegara. Tym samym, gdy wedÅ‚ug wzoru godzina 12 byÅ‚aby na stopniu 90, a godzina 3 na stopniu 0, teraz 12 bÄ™dzie na stopniu 0, a 3 na stopniu 90.

MajÄ…c tÄ™ wiedzÄ™, moÅ¼emy napisaÄ‡ ogÃ³lnÄ… funkcjÄ™ wyznaczajÄ…cÄ… punkt na okrÄ™gu. Jako zmienne przyjmujemy kÄ…t (w radianach, poniewaÅ¼ funkcje trygonometryczne w JavaScript na nich operujÄ…) oraz promieÅ„. Zwracamy wspÃ³Å‚rzÄ™dne punktu w postaci tablicy.

```javascript
const getPosition = (angle, radius) => {
  const x = radius * Math.cos(angle - 0.5 * Math.PI) + centerX;
  const y = radius * Math.sin(angle - 0.5 * Math.PI) + centerY;
  return [x, y];
};
```

### Funkcja rysujÄ…ca wskazÃ³wkÄ™

PrzejdÅºmy nastÄ™pnie do rysowania wskazÃ³wek. Aby je narysowaÄ‡, potrzebujemy mieÄ‡:

- aktualny czas,
- informacje o wyglÄ…dzie (w naszym przypadku bÄ™dzie to tylko kolor konturu),
- promieÅ„ koÅ‚a, ktÃ³rego okrÄ…g rysuje wskazÃ³wka.

JeÅ›li chcemy napisaÄ‡ uniwersalnÄ… funkcjÄ™, nie bÄ™dzie nas interesowaÄ‡ aktualny czas, bo to jest coÅ›, co powinno byÄ‡ znane tylko na poziomie rysowania konkretnej wskazÃ³wki. W przypadku ogÃ³lnej funkcji potrzebujemy jedynie informacji o odchyleniu wskazÃ³wki od godziny 12, czyli kÄ…ta. Z obliczeniem go bÄ™dziemy martwiÄ‡ siÄ™ pÃ³Åºniej. Na razie wystarczy, Å¼ebyÅ›my dostali kÄ…t w radianach.

Taka funkcja moÅ¼e wyglÄ…daÄ‡ nastÄ™pujÄ…co:

```javascript
const drawHand = (angle, color, radius) => {
  const [x, y] = getPosition(angle, radius);
  context.beginPath();
  context.strokeStyle = color;
  context.moveTo(centerX, centerY);
  context.lineTo(x, y);
  context.stroke();
};
```

Jako argumenty przyjmujemy nasze trzy niewiadome, czyli kÄ…t, kolor oraz promieÅ„. Natomiast co wykonujemy dalej? Pierwsze, co musimy znaÄ‡, to wspÃ³Å‚rzÄ™dne punktu na okrÄ™gu przy wskazanym kÄ…cie i promieniu. DokÅ‚adnie to obliczaÅ‚a poprzednio napisana przez nas funkcja, wiÄ™c jÄ… wykonujemy i od razu zrobimy destrukturyzacjÄ™ tablicy w celu uzyskania wspÃ³Å‚rzÄ™dnych `x` i `y` jako oddzielnych zmiennych. NastÄ™pnie rysujemy Å›cieÅ¼kÄ™ o wskazanym kolorze w znany juÅ¼ nam sposÃ³b. Dwie nowe funkcje, ktÃ³re zostaÅ‚y uÅ¼yte zamiast `arc()`, to:

- `moveTo()` przesuwa punkt, od ktÃ³rego zaczynamy rysowanie, do wskazanych wspÃ³Å‚rzÄ™dnych.
- `lineTo()` rysuje odcinek do wskazanego punktu.

### Funkcje do rysowania poszczegÃ³lnych wskazÃ³wek

NastÄ™pnie zdefiniujmy funkcje, ktÃ³re narysujÄ… konkretne wskazÃ³wki. MoÅ¼emy to zrobiÄ‡ na dwa sposoby: proÅ›ciej (ale niezgodnie z tym, jak dziaÅ‚ajÄ… zegary) oraz trudniej.

SposÃ³b prosty to oczywiÅ›cie byÅ‚oby pobranie jako argument funkcji jedynie tej skÅ‚adowej czasu, ktÃ³rÄ… dana wskazÃ³wka wskazuje, czyli np. dla godzinowej godzinÄ™. Funkcja taka mogÅ‚aby wyglÄ…daÄ‡ nastÄ™pujÄ…co:

```javascript
const drawHoursHand = (hours) => {
  const angle = 2 * Math.PI * hours / 12;
  drawHand(angle, "black", HOUR_RADIUS);
};
```

To, co tutaj robimy, to przede wszystkim obliczamy kÄ…t, pod ktÃ³rym ma zostaÄ‡ narysowana wskazÃ³wka wzglÄ™dem godziny 12. Jak to robimy? OtÃ³Å¼ zatoczenie caÅ‚ego okrÄ™gu to kÄ…t $$360^{\circ}$$, czyli $$2\pi$$ radianÃ³w. Taki sam kÄ…t wyznacza rÃ³wnieÅ¼ 12 godzin wyÅ›wietlanych przez zegar. StÄ…d moÅ¼emy podzieliÄ‡ aktualnÄ… liczbÄ™ godzin przez 12, aby otrzymaÄ‡, ile caÅ‚oÅ›ci okrÄ™gu przebyÅ‚a wskazÃ³wka godzinowa. Potem, aby mieÄ‡ to w radianach, mnoÅ¼ymy przez $$2\pi$$.

Wersja ta jednak nie jest najlepsza, ale za to prosta â€” nasza wskazÃ³wka stoi caÅ‚y czas na konkretnej godzinie. Tymczasem na zegarach analogowych wskazÃ³wka siÄ™ przesuwa, na przykÅ‚ad o 2:30 bÄ™dzie w poÅ‚owie drogi miÄ™dzy 2 a 3. Jak to zrobiÄ‡? Tutaj przechodzimy do tej trudniejszej wersji, ale rÃ³Å¼ni siÄ™ ona tylko jednym dodatkowym dziaÅ‚aniem. OtÃ³Å¼ weÅºmiemy dodatkowo pod uwagÄ™ teÅ¼ mniejszÄ… jednostkÄ™ czasu, czyli dla godzin minuty. Zobacz kod:

```javascript
const drawHoursHand = (hours, minutes) => {
  const time = hours + minutes / 60;
  const angle = 2 * Math.PI * time / 12;
  drawHand(angle, "black", HOUR_RADIUS);
};
```

W dodatkowej zmiennej time do liczby godzin dodajemy uÅ‚amek, ktÃ³ry stanowi liczba przebytych minut. Reszta obliczeÅ„ jest dokÅ‚adnie taka sama. W ten wÅ‚aÅ›nie sposÃ³b zrÃ³bmy pozostaÅ‚e wskazÃ³wki. Nie bÄ™dÄ™ siÄ™ juÅ¼ rozpisywaÄ‡, bo obliczenie jest dokÅ‚adnie takie samo, a zmienia siÄ™ jedynia liczba, przez ktÃ³rÄ… dzielimy, co wynika oczywiÅ›cie z tego, ile minut czy sekund widzimy na zegarze.

```javascript
const drawMinutesHand = (minutes, seconds) => {
  const time = minutes + seconds / 60;
  const angle = 2 * Math.PI * time / 60;
  drawHand(angle, "black", MINUTE_RADIUS);
};

const drawSecondsHand = (seconds, milliseconds) => {
  const time = seconds + milliseconds / 1000;
  const angle = 2 * Math.PI * time / 60;
  drawHand(angle, "red", SECOND_RADIUS);
};
```

W przypadku sekund sam(a) zdecyduj, ktÃ³re dziaÅ‚anie wolisz. Jedne zegary analogowe pÅ‚ynnie przesuwajÄ… sekundnik (to bÄ™dzie odwzorowane przez powyÅ¼szy kod), a w innych sekundnik przeskakuje. JeÅ›li wolisz przeskakiwanie, to usuÅ„ wykorzystanie milisekund przy obliczaniu kÄ…ta.

### Pobranie aktualnego czasu i wstawienie do funkcji rysujÄ…cej

To, co nam zostaje, to wykorzystaÄ‡ napisany kod w funkcji rysujÄ…cej animacjÄ™. Tylko Å¼e najpierw musimy pobraÄ‡ aktualny czas. Aby nie byÅ‚o rozjazdÃ³w miÄ™dzy wskazÃ³wkami, zrobimy to tylko raz, a nastÄ™pnie przekaÅ¼emy konkretne wartoÅ›ci do poszczegÃ³lnych funkcji. W JavaScript moÅ¼emy to zrobiÄ‡ nastÄ™pujÄ…co:

```javascript
const currentTime = new Date();
const hours = currentTime.getHours() % 12;
const minutes = currentTime.getMinutes();
const seconds = currentTime.getSeconds();
const milliseconds = currentTime.getMilliseconds();
```

W przypadku godzin interesuje nas wartoÅ›Ä‡ modulo 12, poniewaÅ¼ zegary analogowe pracujÄ… w trybie 12-godzinnym, podczas gdy `getHours()` zwraca wartoÅ›ci miÄ™dzy 0 a 24.

Skoro mamy pobrany czas, moÅ¼emy zÅ‚oÅ¼yÄ‡ wszystko w caÅ‚oÅ›Ä‡. Funkcja `draw()` bÄ™dzie teraz wyglÄ…daÄ‡ nastÄ™pujÄ…co:

```javascript
const draw = () => {
  const currentTime = new Date();
  const hours = currentTime.getHours() % 12;
  const minutes = currentTime.getMinutes();
  const seconds = currentTime.getSeconds();
  const milliseconds = currentTime.getMilliseconds();

  clear();
  drawBorder();
  drawHoursHand(hours, minutes);
  drawMinutesHand(minutes, seconds);
  drawSecondsHand(seconds, milliseconds);

  window.requestAnimationFrame(() => {
    draw();
  });
};
```

Graficznie daje to taki efekt, ktÃ³ry dla wielu moÅ¼e byÄ‡ juÅ¼ zupeÅ‚nie wystarczajÄ…cy:

<Image
  image={zegarWskazowki}
  alignCenter
  fullSize
  maxWidth="500px"
  alt="Czarny okrÄ…g na biaÅ‚ym tle z trzema wskazÃ³wkami."
  caption={<>Jak coÅ›, to tylko zrzut ekranu, dlatego nic siÄ™ nie rusza.</>}
/>

## Narysowanie tarczy

Mamy juÅ¼ dziaÅ‚ajÄ…cy, minimalistyczny zegar, ale zrezygnujmy z tego prostego wyglÄ…du i udekorujmy nieco tarczÄ™. ProponujÄ™ dodaÄ‡:

- oznaczenia konkretnych minut (krÃ³tkie odcinki),
- nieco bardziej wyraÅºne oznaczenie co 5 minut (trochÄ™ dÅ‚uÅ¼sze odcinki),
- oznaczenia godzin (tekst).

Wszystko to moÅ¼emy zrobiÄ‡ za pomocÄ… narzÄ™dzi matematycznych, ktÃ³re juÅ¼ poznaliÅ›my wczeÅ›niej â€” tylko tym razem zamiast do rysowania dynamicznego wskazÃ³wek, wykorzystamy je do dekoracji.

### Zdefiniowanie dodatkowych staÅ‚ych

Zacznijmy od poczÄ…tku, czyli od zdefiniowania dodatkowych staÅ‚ych. Podobnie jak przy poprzednich przypadkach, tutaj teÅ¼ bÄ™dziemy umieszczaÄ‡ rzeczy na okrÄ™gu. A bÄ™dÄ… nam potrzebne trzy dodatkowe promienie:

- promieÅ„ okrÄ™gu wyznaczajÄ…cego koniec odcinka oznaczenia minut (poczÄ…tek bÄ™dzie mieÄ‡ taki sam promieÅ„ jak caÅ‚y zegar),
- to, co wyÅ¼ej, ale dla odcinka rysowanego co 5 minut,
- oraz promieÅ„ okrÄ™gu, na ktÃ³rym bÄ™dÄ… wypisywane godziny.

W pierwszym przypadku ustalmy sobie, Å¼e np. promieÅ„ ten bÄ™dzie mniejszy o 5 pikseli od promienia caÅ‚ego zegara. W drugim przypadku moÅ¼emy np. uzaleÅ¼niÄ‡ siÄ™ od poprzednio wyznaczonego promienia, Å¼e bÄ™dzie mniejszy o kolejne 5 pikseli. A co z ostatnim przypadkiem? Liczby najlepiej bÄ™dÄ… wyglÄ…daÄ‡ miÄ™dzy Å›cieÅ¼kÄ… najdÅ‚uÅ¼szej wskazÃ³wki (w naszym przypadku sekundowej) a koÅ„cem odcinka wyznaczanego co 5 minut.

JeÅ›li chcemy te wartoÅ›ci uzaleÅ¼niÄ‡ od wczeÅ›niej wyznaczanych przez nas promieni, moglibyÅ›my to zrobiÄ‡ w nastÄ™pujÄ…cy sposÃ³b:

```javascript
const MINUTE_MARKER_RADIUS = OUTER_RADIUS - 5;
const SECOND_MINUTE_MARKER_RADIUS = MINUTE_MARKER_RADIUS - 5;
const HOUR_MARKER_RADIUS = (SECOND_RADIUS + SECOND_MINUTE_MARKER_RADIUS) / 2;
```

W ostatnim przypadku liczymy Å›redniÄ… arytmetycznÄ… dla dwÃ³ch wskazanych przeze mnie promieni, aby otrzymaÄ‡ wartoÅ›Ä‡ â€poÅ›rodkuâ€.

### Narysowanie oznaczeÅ„ minut

Zacznijmy od narysowania oznaczeÅ„ minut. Aby to zrobiÄ‡, musimy najzwyczajniej w Å›wiecie <Link href="/post/iteracja-co-to-jest">przeiterowaÄ‡</Link> po kolejnych liczby od 1 do 60. OczywiÅ›cie wszystko zamknijmy w funkcji, aby mÃ³c to Å‚adnie wywoÅ‚aÄ‡ w `draw()`:

```javascript
const drawFace = () => {
  for (let i = 1; i <= 60; i++) {
    // tutaj wstawimy kod, ktÃ³ry bÄ™dziemy dalej pisaÄ‡
  }
};
```

NastÄ™pnie caÅ‚e rysowanie powiela w zasadzie to, co robiliÅ›my dotychczas. Najpierw obliczamy kÄ…t â€” robimy to tak samo, jak dla minut (w koÅ„cu rysujemy minuty, jedynie nie bierzemy pod uwagÄ™ sekund). NastÄ™pnie liczymy pozycjÄ™ na brzegu zegara, a potem, w zaleÅ¼noÅ›ci czy wartoÅ›Ä‡ jest podzielna przez 5, pozycjÄ™ do bliÅ¼szego lub dalszego okrÄ™gu. MajÄ…c obie pozycje, moÅ¼emy przystÄ…piÄ‡ do rysowania odcinka. Wszystko to zamkniemy w poniÅ¼szym kodzie:

```javascript
const divisibleBy5 = i % 5 === 0;
const angle = 2 * Math.PI * i / 60;
const radius = divisibleBy5
  ? SECOND_MINUTE_MARKER_RADIUS
  : MINUTE_MARKER_RADIUS;
const [startX, startY] = getPosition(angle, radius);
const [endX, endY] = getPosition(angle, OUTER_RADIUS);

context.beginPath();
context.strokeStyle = "black";
context.moveTo(startX, startY);
context.lineTo(endX, endY);
context.stroke();
```

### Narysowanie oznaczeÅ„ godzin

Jak moÅ¼esz siÄ™ spodziewaÄ‡, rysowanie godzin nie bÄ™dzie duÅ¼o bardziej skomplikowane, jest to tylko napisanie tekstu w miejscu wyznaczonym przez `getPosition`. KÄ…t juÅ¼ mamy. Jedyne, co musimy ustaliÄ‡, to ktÃ³rÄ… godzinÄ™ rysujemy, ale to moÅ¼na obliczyÄ‡, dzielÄ…c aktualnÄ… wartoÅ›Ä‡ licznika przez 5 (w koÅ„cu wskazanie kolejnej godziny jest co â€5 minutâ€).

Nie przedÅ‚uÅ¼ajÄ…c, zrobimy to nastÄ™pujÄ…cym kodem:

```javascript
if (divisibleBy5) {
  const hour = (i / 5).toString();
  const [x, y] = getPosition(angle, HOUR_MARKER_RADIUS);
  context.font = "24px serif";
  context.textAlign = "center";
  context.textBaseline = "middle";
  context.fillText(hour, x, y);
}
```

W zasadzie robimy tutaj analogiczne rzeczy jak do tej pory. NowoÅ›ciÄ… jest pisanie tekstu na ekranie. W `font` ustawiamy czcionkÄ™ â€” jej rozmiar i krÃ³j. W tym przypadku nie ustaliÅ‚em konkretnej czcionki, a jedynie rodzaj â€” szeryfowÄ…. `textAlign` decyduje o uÅ‚oÅ¼eniu tekstu w poziomie, wiÄ™c aby zostaÅ‚ napisany na Å›rodku wyznaczonego przez nas punktu, musimy go wyÅ›rodkowaÄ‡. `textBaseline` to analogiczna wÅ‚asnoÅ›Ä‡, ale ukÅ‚ada tekst w pionie â€” tutaj teÅ¼ nas interesuje wyÅ›rodkowanie.

Po zÅ‚oÅ¼eniu w caÅ‚oÅ›Ä‡ funkcji `drawFace()` moÅ¼esz jÄ… dopisaÄ‡ do `draw()`.

## Koniec implementacji (gotowce tutaj)

Oto skoÅ„czyliÅ›my implementacjÄ™. JeÅ›li podÄ…Å¼aÅ‚eÅ›(-aÅ›) za moimi instrukcjami, na Twoim ekranie powinno byÄ‡ widoczne mniej wiÄ™cej coÅ› takiego jak poniÅ¼ej:

<Presentation />

CaÅ‚y kod wraz z moÅ¼liwoÅ›ciÄ… edycji znajdziesz na poniÅ¼szych platformach. Wybierz, ktÃ³rÄ… wolisz:

- [CodePen](https://codepen.io/tswistak/pen/XWBgrbJ)
- [repl.it](https://replit.com/@tswistak/clock-js#script.js)

DajÄ™ rÃ³wnieÅ¼ obiecanÄ… przeze mnie na poczÄ…tku wersjÄ™ napisanÄ… w Pythonie z pygame. Znajdziesz jÄ… takÅ¼e na [repl.it](https://replit.com/@tswistak/clock-py#main.py). Zegar ten w przeciwieÅ„stwie do JavaScriptowego moÅ¼e wydawaÄ‡ siÄ™ miejscami krzywo narysowany, ale jest to wina zaokrÄ…gleÅ„ przy obliczaniu pozycji i rÃ³wnoczeÅ›nie braku antyaliasingu. Na canvasie w JS antyaliasing jest domyÅ›lnie wÅ‚Ä…czony, dlatego mimo niedoskonaÅ‚oÅ›ci wynikajÄ…cych z zaokrÄ…gleÅ„ caÅ‚oÅ›Ä‡ wyglÄ…da dobrze. W pygame sÄ… [funkcje umoÅ¼liwiajÄ…ce rysowanie z antyaliasingiem](https://www.pygame.org/docs/ref/gfxdraw.html), wiÄ™c jeÅ›li jesteÅ› chÄ™tny(-a), moÅ¼esz sprÃ³bowaÄ‡ przerobiÄ‡ gotowca i sprawdziÄ‡, czy bÄ™dzie wyglÄ…daÄ‡ wtedy lepiej.

## Podsumowanie

W artykule pokazaÅ‚em, w jaki sposÃ³b, wykorzystujÄ…c matematykÄ™ na poziomie szkoÅ‚y Å›redniej, moÅ¼emy zrobiÄ‡ prostÄ… i uÅ¼ytecznÄ… animacjÄ™. Pokazuje to teÅ¼ doÅ›Ä‡ typowy sposÃ³b rozwiÄ…zywania wszelkich problemÃ³w przy programowaniu:

- ZnaleÅºÄ‡ uogÃ³lnienie problemu â€” tutaj: potraktowanie wskazÃ³wek jako czegoÅ›, co wskazuje konkretny punkt na okrÄ™gu.
- ZnaleÅºÄ‡ sposÃ³b rozwiÄ…zania uogÃ³lnionego problemu â€” wykorzystanie wzorÃ³w trygonometrycznych na boki trÃ³jkÄ…ta w celu znalezienia pozycji punktu na okrÄ™gu.
- ZastosowaÄ‡ rozwiÄ…zanie na naszym szczegÃ³Å‚owym problemie â€” wykorzystanie wzoru do znajdowania pozycji wskazÃ³wek w zaleÅ¼noÅ›ci od aktualnej godziny.

Mam nadziejÄ™, Å¼e artykuÅ‚ pokazaÅ‚ Ci, jak podchodziÄ‡ do takich prostych problemÃ³w. A jeÅ›li jesteÅ› tutaj tylko po gotowca, to mam nadziejÄ™, Å¼e siÄ™ przyda ğŸ˜Š.

<small>ZdjÄ™cie na okÅ‚adce wygenerowane przez Stable Diffusion.</small>
