import Link from 'next/link';
import {Image, Iframe} from '@swistak-codes/components';
import cover from './kukulka.jpg';
import date from './date.png';
import dateUnix from './dateunix.png';
import ntp from './NTP_stratum.png';

export const meta = {
  title: 'Jak komputer przechowuje datÄ™ i skÄ…d zna aktualnÄ…?',
  abstract:
    'W tym artykule dowiesz siÄ™, jak oprogramowanie przechowuje datÄ™ i skÄ…d jÄ… zna. Poznasz miÄ™dzy innymi, czym jest czas uniksowy, co to NTP itd.',
  firstParagraph: (
    <>
      Po artykule o tym, <Link href="/post/jak-komputer-mierzy-czas">w jaki sposÃ³b sprzÄ™t komputerowy odmierza czas</Link>,
      mogÅ‚eÅ›(-aÅ›) zastanawiaÄ‡ siÄ™, co dalej siÄ™ z tym dzieje? ParÄ™ razy podkreÅ›laÅ‚em, Å¼e na co dzieÅ„ nie korzystamy
      bezpoÅ›rednio ze sprzÄ™towych wskaÅºnikÃ³w, tylko wykorzystujemy te wbudowane w systemy operacyjne czy jÄ™zyki
      programowania. W tym artykule dowiesz siÄ™, jak oprogramowanie przechowuje datÄ™ i skÄ…d jÄ… zna. Poznasz miÄ™dzy
      innymi, czym jest czas uniksowy, co to jest NTP, a takÅ¼e co siÄ™ wydarzy w roku 2137.
    </>
  ),
  keyword: 'data',
  categories: ['Teoria informatyki', 'Data i czas'],
  tags: [
    'NTP',
    'czas uniksowy',
    'epoch',
    'GPS',
    'ISO 8861',
    'RFC 3339',
    'PTP',
    'zegar atomowy',
    'rok 2000',
    '19 stycznia 2038',
    'stratum',
    'bts',
    'rds',
    'dcf77',
  ],
  slug: 'jak-komputer-przechowuje-date-i-skad-zna-aktualna',
  updateTime: '2021-08-17T16:42:13+00:00',
  publishTime: '2021-07-07T09:00:08+00:00',
  cover,
};

## Sposoby przechowywania i zapisu czasu

Teraz przejdÅºmy do tej czÄ™Å›ci niesprzÄ™towej, a mianowicie, w jaki sposÃ³b oprogramowanie komputera przechowuje datÄ™. Odbywa siÄ™ to na rÃ³Å¼ne sposoby, inne niÅ¼ zapis w CMOS, dlatego opowiemy sobie o tym doÅ›Ä‡ szczegÃ³Å‚owo.

### Epoka

Przede wszystkim, zacznijmy od teoretycznych podstaw. MÃ³wiÄ…c na co dzieÅ„ o datach, nie myÅ›limy o Å¼adnych â€limitachâ€. Mamy co prawda podziaÅ‚ na naszÄ… erÄ™ i czasy przed niÄ…, jednak tak naprawdÄ™, patrzÄ…c na przeszÅ‚oÅ›Ä‡, moÅ¼emy podawaÄ‡ dowolne wartoÅ›ci przed naszÄ… erÄ…. Tymczasem komputery tak nie dziaÅ‚ajÄ… i musimy mieÄ‡ pewnÄ… datÄ™ granicznÄ…, od ktÃ³rej liczymy czas. Nazywamy jÄ… epokÄ… (z ang. epoch).

W tym miejscu zaczyna siÄ™ ciekawie, bo komputery nie majÄ… jednego konkretnego wydarzenia, ktÃ³re oznaczaÅ‚oby poczÄ…tek czasu. Nie jest to ani wielki wybuch, ani teÅ¼ orientacyjna data narodzin Chrystusa (tak nawiasem mÃ³wiÄ…c, najprawdopodobniej nie urodziÅ‚ siÄ™ roku pierwszego). KaÅ¼dy producent systemÃ³w operacyjnych, a nawet oprogramowania, przyjÄ…Å‚ wÅ‚asny start epoki. Do najpopularniejszych moÅ¼emy zaliczyÄ‡:

- 1 stycznia 1601 roku â€” zwany teÅ¼ czasem epokowym NT (z ang. NT time epoch); od tej daty zaczynajÄ… liczyÄ‡ systemy Microsoft Windows w wersji NT (czyli NT, 2000, XP i nowsze). Data ta nie ma Å¼adnego historycznego znaczenia, jedynie matematyczne, o czym moÅ¼emy przeczytaÄ‡ [w krÃ³tkiej notce na stronie Microsoftu](https://devblogs.microsoft.com/oldnewthing/20090306-00/?p=18913).
- 0 stycznia 1900 roku â€” jest to najstarsza data, ktÃ³rÄ… uÅ¼ywajÄ… arkusze kalkulacyjne Microsoft Excel oraz Lotus 1-2-3. OczywiÅ›cie taki dzieÅ„ jak 0 stycznia nie istnieje i oznacza on wtedy 31 grudnia poprzedniego roku. Przy czym ze wzglÄ™du na bÅ‚Ä…d, ktÃ³ry traktowaÅ‚ 1900 rok jako rok przestÄ™pny (a nim nie jest), trzeba byÅ‚o wprowadziÄ‡ korektÄ™, Å¼e 0 stycznia to tak naprawdÄ™ 30 grudnia 1899. StÄ…d teÅ¼ czÄ™sto moÅ¼na spotkaÄ‡ siÄ™ z tym, Å¼e epoka ta zaczyna siÄ™ od tegoÅ¼ wÅ‚aÅ›nie dnia.
- 1 stycznia 1970 roku â€” najbardziej znany komputerowy poczÄ…tek czasu, znany jako czas uniksowy (z ang. Unix Time, Unix Epoch; teÅ¼ spotyka siÄ™ nazwÄ™ czas POSIX). Wykorzystywany jest przez systemy uniksowe (np. BSD, macOS, iOS) oraz uniksopodobne (np. Linux, Android) oraz wiele popularnych jÄ™zykÃ³w programowania.
- 6 stycznia 1980 roku â€” od tej daty czas liczy system nawigacji GPS. Taka nietypowa data wziÄ™Å‚a siÄ™ stÄ…d, Å¼e pod tÄ… datÄ… kryje siÄ™ pierwsza niedziela 1980 roku, a niedzielÄ™ uznaje siÄ™ za poczÄ…tek tygodnia (amerykaÅ„skie podejÅ›cie do oznaczania tygodni).

### Czas uniksowy

PoÅ›wiÄ™Ä‡my nieco uwagi czasowi uniksowemu, poniewaÅ¼ jest najpowszechniej stosowanym sposobem zapisu daty i zdecydowanie jednym z najwaÅ¼niejszych. W zapisie tym data jest przedstawiona jako liczba sekund, jaka minÄ™Å‚a od godziny 00:00 1 stycznia 1970 na rÃ³wnoleÅ¼niku zerowym (czyli czasu UTC). Moment ten nazywa siÄ™ epokÄ… uniksowÄ….

Standardowo czas ten jest zapisywany w postaci zmiennej caÅ‚kowitoliczbowej 32-bitowej ze znakiem. BiorÄ…c pod uwagÄ™, Å¼e jeden dzieÅ„ trwa 86400 sekund, zapis ten moÅ¼e przechowaÄ‡ okoÅ‚o 136 lat. ZwiÄ…zany z tym problem opisaÅ‚em pod koniec artykuÅ‚u.

Spotykane sÄ… takÅ¼e formy odliczajÄ…ce czas dokÅ‚adniej, np. jako liczba milisekund od epoki uniksowej albo nawet nanosekund. Tradycyjnie w systemach uniksowych zwraca siÄ™ wÃ³wczas dwie wartoÅ›ci â€” liczbÄ™ sekund oraz czÄ™Å›Ä‡ uÅ‚amkowÄ…. Natomiast inne implementacje mogÄ… dziaÅ‚aÄ‡ inaczej, np. w JavaScripcie jest to po prostu jedna liczba caÅ‚kowita wyraÅ¼ajÄ…ca liczbÄ™ milisekund.

Jako ciekawostkÄ™ dodam, Å¼e czas uniksowy nie zawsze zaczynaÅ‚ siÄ™ od daty 1.01.1970 i nie zawsze odmierzaÅ‚ liczbÄ™ sekund. Wersja opisana w â€Unix Programmer's Manualâ€ z 1971 roku odliczaÅ‚a czas od 00:00:00 1 stycznia 1971 roku w 1/60 sekundy. Tym samym 32-bitowy zakres zmiennej wyczerpaÅ‚ siÄ™ po okoÅ‚o 2,5 roku.

<Image
  image={date}
  alignCenter
  fullSize
  alt="Terminal z macOS z uruchomionym poleceniem 'date +%s'"
  caption={<>
    Czas uniksowy sprawdzony w momencie pisania artykuÅ‚u. JesteÅ› w stanie odczytaÄ‡, kiedy wykonaÅ‚em polecenie?
  </>}
  forceWhiteBackground={false}
/>

### ISO 8601 / RFC 3339

Standard ISO 8601 nie jest stricte zwiÄ…zany z komputerami, jednak programiÅ›ci mogÄ… bardzo czÄ™sto na niego trafiÄ‡, a takÅ¼e z niego korzystaÄ‡. Jest bowiem najpowszechniejszym i (nomen omen) standardowym sposobem zapisu daty i czasu jako ciÄ…gu znakÃ³w. W zastosowaniach informatycznych jego implementacjÄ… jest standard RFC 3339.

Nie chcÄ™ wchodziÄ‡ w szczegÃ³Å‚y standardu, jak i jego szczegÃ³Å‚Ã³w. Definiowane sÄ… tam rzeczy, ktÃ³re uznajemy za oczywiste, jak chociaÅ¼by, jaki kalendarz wykorzystujemy. Z punktu widzenia praktyka informatyki najbardziej interesuje nas format zapisu. Standard operuje kilkoma postaciami, z ktÃ³rych najwaÅ¼niejsze (zapisujÄ…ce rÃ³wnoczeÅ›nie datÄ™ i czas) to:

- [YYYY]-[MM]-[DD]T[hh]:[mm]:[ss]Z
- [YYYY]-[MM]-[DD]T[hh]:[mm]:[ss.sss]Â±[hh]:[mm]
- [YYYY][MM][DD]T[hh][mm][ss]Z
- [YYYY][MM][DD]T[hh][mm][ss]Â±[hh]:[mm]

W powyÅ¼szym schemacie zapisu zastosowano poniÅ¼sze oznaczenia:

- [YYYY] â€” rok w postaci czterocyfrowej. JeÅ¼eli natomiast potrzebowalibyÅ›my okreÅ›liÄ‡ rok przed naszÄ… erÄ…, dopuszczalny jest teÅ¼ zapis [Â±YYYYY] (niedopuszczalny w standardzie RFC 3339). Co jest istotne w przypadku dat, pierwszy rok naszej ery to rok 0000, natomiast ostatni rok przed naszÄ… erÄ… to 0001.<br />
PrzykÅ‚ady lat zapisanych w tej formie:
  - 2021
  - 0000
  - +0234
  - -12333
- [MM] â€” miesiÄ…c w postaci dwucyfrowej oraz [DD] â€” dzieÅ„ w postaci dwucyfrowej. Odliczanie zaczynamy zawsze od 1 i w przypadku jednocyfrowych liczb dopisujemy z przodu zero.
- [hh] â€” godzina w postaci dwucyfrowej, [mm] â€” minuty w postaci dwucyfrowej oraz [ss] â€” sekundy w postaci dwucyfrowej. Tutaj rÃ³wnieÅ¼ stosujemy dopisywanie zera, jednak odliczanie zaczynamy od 0. Natomiast jeÅ¼eli zapis zawiera sekundy wraz z czÄ™Å›ciÄ… dziesiÄ™tnÄ… (dokÅ‚adnie do trzech miejsc po przecinku), to sÄ… to milisekundy.
- T â€” separator daty od czasu. Warto wspomnieÄ‡, Å¼e RFC 3339 dopuszcza zastÄ…pienie go spacjÄ… dla czytelnoÅ›ci.
- Z lub Â±[hh]:[mm] â€” oznaczenie strefy czasowej. Z to â€zerowaâ€ strefa czasowa, natomiast pozostaÅ‚e okreÅ›lamy jako rÃ³Å¼nica czasu wzglÄ™dem niej.

<Image
  image={dateUnix}
  alignCenter
  fullSize
  alt="Terminal z macOS z uruchomionym poleceniem 'date +%s ; date -u +%FT%TZ'"
  caption={<>
    Czas uniksowy i odpowiadajÄ…cy mu zapis w standardzie ISO 8601.
  </>}
  forceWhiteBackground={false}
/>

Jako ciekawostkÄ™ dodam, Å¼e w wielu krajach na Å›wiecie, ichniejsze urzÄ™dy odpowiadajÄ…ce za miary przyjÄ™Å‚y ISO 8601 jako standard formalnego zapisu daty i czasu. Do tych krajÃ³w, co ciekawe, Polska zaliczaÅ‚a siÄ™ tylko do maja 2008 roku, gdy to norma PN-EN 28601 przyjmujÄ…ca ISO 8601 zostaÅ‚a wycofana bez zastÄ…pienia innÄ….

### Aktualna data i czas w rÃ³Å¼nych formatach

<Iframe src="/iframe-content/time/index.html" minHeight={255} />

## SkÄ…d komputery znajÄ… aktualnÄ… datÄ™?

OpowiedzieliÅ›my sobie o odliczaniu czasu i jego przechowywaniu, jednak uniknÄ™liÅ›my bardzo waÅ¼nej informacji â€” skÄ…d w ogÃ³le komputer wie, jaka jest aktualna data?

Tak, oczywiÅ›cie najprostsza odpowiedÅº to taka, Å¼e uÅ¼ytkownik sam podaje datÄ™. Jednak oprÃ³cz tego istnieje wiele sposobÃ³w, dziÄ™ki ktÃ³rym komputer moÅ¼e samodzielnie poznaÄ‡ aktualnÄ… datÄ™ i czas, dlatego krÃ³tko sobie o nich opowiedzmy.

### NTP

NajpopularniejszÄ… metodÄ… odkrywania czasu jest wykorzystanie protokoÅ‚u sieciowego Network Time Protocol (w skrÃ³cie NTP) lub jego uproszczonej wersji SNTP. UÅ¼ywa siÄ™ go do pobierania czasu o bardzo wysokiej dokÅ‚adnoÅ›ci ze specjalnie przystosowanych do tego celu serwerÃ³w, ktÃ³re sÄ… albo podÅ‚Ä…czone bezpoÅ›rednio do wzorcÃ³w czasu, albo do innych serwerÃ³w czasu. UrzÄ…dzenie stanowiÄ…ce wzorzec czasu naleÅ¼y do warstwy zwanej STRATUM 0, natomiast kolejne warstwy komputerÃ³w to STRATUM 1 do 15. Liczba oznacza odlegÅ‚oÅ›Ä‡ do wzorca czasu.

<Image
  image={ntp}
  alignCenter
  fullSize
  alt="STRATUM 0: Dwa zegary. STRATUM 1: Dwa serwery poÅ‚Ä…czone z zegarami i miÄ™dzy sobÄ…. STRATUM 2: Trzy serwery poÅ‚Ä…czone z warstwÄ… STRATUM 1 oraz dwa miÄ™dzy sobÄ…. STRATUM 3: 4 serwery poÅ‚Ä…czone z warstwÄ… STRATUM 2 oraz miÄ™dzy sobÄ…"
  caption={<>
    Schemat warstw STRATUM i moÅ¼liwych poÅ‚Ä…czeÅ„ miÄ™dzy serwerami i zegarami.
  </>}
/>

Oryginalnie wzorcem STRATUM 0 byÅ‚ cezowy zegar atomowy, jednak obecnie dopuszcza siÄ™ teÅ¼ rÃ³Å¼ne inne ÅºrÃ³dÅ‚a, jak satelitarne czy radiowe. SÄ… one podÅ‚Ä…czane bezpoÅ›rednio do serwerÃ³w czasu i nie sÄ… udostÄ™pniane w Internecie. OpÃ³Åºnienie na tym poÅ‚Ä…czeniu liczone jest w kilku mikrosekundach.

Serwery czasu przesyÅ‚ajÄ… informacjÄ™ o czasie zapisanÄ… na 64-bitach, gdzie pierwsze 32 bity skÅ‚adajÄ… siÄ™ na liczbÄ™ sekund, jaka upÅ‚ynÄ™Å‚a od 1 stycznia 1900 roku, a kolejne odpowiedzialne sÄ… za uÅ‚amkowÄ… czÄ™Å›Ä‡ sekundy. Oznacza to, Å¼e moÅ¼na w ten sposÃ³b zapisaÄ‡ okoÅ‚o 136 lat ($$2^{32}$$ sekund) z rozdzielczoÅ›ciÄ… 233 pikosekund ($$2^{-32}$$ sekund). Jednak mimo tak wysokiej rozdzielczoÅ›ci zakÅ‚ada siÄ™, Å¼e bÅ‚Ä…d pomiaru moÅ¼e wynosiÄ‡ ok. 1 milisekundy.

Obecnie praktycznie kaÅ¼dy system operacyjny posiada moÅ¼liwoÅ›Ä‡ synchronizacji czasu za pomocÄ… NTP, dziÄ™ki czemu majÄ…c poÅ‚Ä…czenie do Internetu, zwykle nie trzeba ustawiaÄ‡ daty. W zaleÅ¼noÅ›ci od systemu wykorzystywane sÄ… rÃ³Å¼ne serwery od dostawcÃ³w systemÃ³w, jak time.windows.com czy time.apple.com. Warto jednak wiedzieÄ‡, Å¼e moÅ¼emy teÅ¼ korzystaÄ‡ z serwerÃ³w bliÅ¼ej nas. PrzykÅ‚adowo, GÅ‚Ã³wny UrzÄ…d Miar utrzymuje dwa serwery czasu typu STRATUM 1: `tempus1.gum.gov.pl` i `tempus2.gum.gov.pl`.

### PTP

Precision Time Protocol (PTP) to kolejne podejÅ›cie do synchronizacji czasu przez Internet. W zaÅ‚oÅ¼eniu ma byÄ‡ bardziej precyzyjne niÅ¼ NTP, tym samym nadajÄ…ce siÄ™ do bardziej specjalistycznych rozwiÄ…zaÅ„, gdzie jest potrzebna wysoka precyzja pomiaru czasu. PTP jest opisany przez standard IEEE 1588.

Wysoka precyzja czasu w przypadku PTP oznacza, Å¼e bÅ‚Ä…d pomiaru moÅ¼e wynosiÄ‡ tutaj jedynie ok. 100 nanosekund. Do wiÄ™kszoÅ›ci codziennych zastosowaÅ„ taka dokÅ‚adnoÅ›Ä‡ nie jest jednak potrzebna, dlatego nie znajdziemy darmowych serwerÃ³w PTP.

Zasada dziaÅ‚ania jest bardzo zbliÅ¼ona do NTP. Posiadamy wzorzec czasu (tutaj nazywany STRATUM 1), ktÃ³ry jest podÅ‚Ä…czony do gÅ‚Ã³wnego serwera czasu (z ang. Grand Master Clock, STRATUM 2). NastÄ™pnie mamy trzeciÄ… warstwÄ™ (STRATUM 3), gdzie znajdujÄ… siÄ™ serwery czasu. RÃ³Å¼nica wzglÄ™dem NTP jest taka, Å¼e gdy w nim serwer czasu zwracaÅ‚ informacjÄ™ na konkretne Å¼Ä…danie, tak w PTP serwer czasu stale rozsyÅ‚a aktualny czas do wszystkich podÅ‚Ä…czonych do niego serwerÃ³w (za pomocÄ… multicast). Standard definiuje jeszcze moÅ¼liwÄ… warstwÄ™ STRATUM 4.

### Zegary atomowe

Komputery oczywiÅ›cie nie muszÄ… jedynie w taki sposÃ³b odkrywaÄ‡ aktualnego czasu. Istnieje takÅ¼e wiele innych ÅºrÃ³deÅ‚, do ktÃ³rych niekoniecznie trzeba mieÄ‡ poÅ‚Ä…czenie z Internetem.

Przede wszystkim naleÅ¼y wiedzieÄ‡, Å¼e serwery czasu, czy to dziaÅ‚ajÄ…ce w protokole NTP, czy PTP, muszÄ… skÄ…dÅ› braÄ‡ czas. WspomniaÅ‚em, Å¼e zwykle sÄ… to zegary atomowe i jest to jak najbardziej kolejne ÅºrÃ³dÅ‚o czasu dla komputera. Obecnie takie zegary sÄ… niewielkich rozmiarÃ³w, ale bardzo drogie, wiÄ™c nie spodziewajmy siÄ™, Å¼e bÄ™dÄ… montowane w zwykÅ‚ych komputerach. Za to oprÃ³cz serwerÃ³w czasu moÅ¼emy je znaleÅºÄ‡ takÅ¼e w bardzo specjalistycznych sprzÄ™tach, jak np. satelity.

### GPS

MÃ³wiÄ…c o satelitach, one teÅ¼ mogÄ… byÄ‡ ÅºrÃ³dÅ‚em czasu. W szczegÃ³lnoÅ›ci mowa tutaj o satelitach geolokalizacyjnych, czyli GPS, GLONASS, Beidou i Galileo. Jak juÅ¼ wspomniaÅ‚em wczeÅ›niej, posiadajÄ… one na pokÅ‚adzie zegary atomowe bÄ™dÄ…ce w staÅ‚ej synchronizacji miÄ™dzy sobÄ…. W przypadku GPS, odbierajÄ…c sygnaÅ‚ z satelity, otrzymujemy 5 ramek wiadomoÅ›ci, gdzie pierwsza zawiera informacjÄ™ o czasie. SkÅ‚ada siÄ™ ona z dwÃ³ch wartoÅ›ci: liczby tygodni, ktÃ³re minÄ™Å‚y od 6 stycznia 1980 roku oraz czasu tygodnia. Czas tygodnia liczony jest w rozdzielczoÅ›ci 1,5 sekundy i tym samym mieÅ›ci siÄ™ w zakresie wartoÅ›ci 0 do 403199.

### Nadajniki naziemne

Ostatnim ÅºrÃ³dÅ‚em czasu, o jakim chciaÅ‚em wspomnieÄ‡, jest data nadawana z nadajnikÃ³w naziemnych. MoÅ¼emy tutaj wymieniÄ‡ nastÄ™pujÄ…ce sposoby:

- Telefony sÄ… w stanie poznaÄ‡ aktualny czas z nadajnikÃ³w sieci komÃ³rkowej (BTS).
- SygnaÅ‚ RDS przesyÅ‚any wraz ze stacjami radiowymi na standardowym paÅ›mie FM oprÃ³cz informacji, ktÃ³re widzimy na odbiorniku jak nazwa piosenki, przesyÅ‚a takÅ¼e informacjÄ™ o dacie.
- IstniejÄ… specjalne wzorce czasu nadawane na dÅ‚ugich falach radiowych. Najbardziej znanym w Europie jest niemiecki DCF77, ktÃ³ry swoim zasiÄ™giem pokrywa niemal caÅ‚y kontynent. Pojedyncza ramka transmisji trwa 59 sekund, gdzie kaÅ¼dy bit trwa sekundÄ™. Bity od 21 do 57 przechowujÄ… informacjÄ™ o dacie, ktÃ³ra jest zapisana w kodowaniu BCD.

## Komputerowe â€apokalipsyâ€

Jak moÅ¼esz wiedzieÄ‡, wszystko na komputerze ma skoÅ„czonÄ… pojemnoÅ›Ä‡. CzÄ™sto w tym artykule zaznaczaÅ‚em chociaÅ¼by o przechowywaniu czegoÅ› w 32- lub 64-bitach. Problem ten dotyczy takÅ¼e dat i moÅ¼e mieÄ‡ powaÅ¼ne konsekwencje. Wiele aplikacji polega na aktualnej dacie, np. systemy bankowe. Gdyby w takim systemie oraz innych na Å›wiecie data nagle cofnÄ™Å‚a siÄ™ na 1 stycznia 1900 roku, raczej moÅ¼na by wÃ³wczas spokojnie mÃ³wiÄ‡ o komputerowej apokalipsie. Zobaczmy, kiedy takie problemy mogÅ‚y i mogÅ‚yby siÄ™ zdarzyÄ‡, oraz jak postanowiono im zaradziÄ‡.

### Rok 2000

Zacznijmy od â€apokalipsyâ€, ktÃ³rej udaÅ‚o siÄ™ uniknÄ…Ä‡, czyli problem roku 2000, znany teÅ¼ jako pluskwa milenijna. Problem ten wynikaÅ‚ z faktu, Å¼e na dawnych komputerach, dla zaoszczÄ™dzenia miejsca, rok zapisywano w postaci dwÃ³ch ostatnich cyfr. JednoczeÅ›nie zakÅ‚adano, Å¼e oprogramowanie wtedy powstajÄ…ce nie bÄ™dzie w uÅ¼yciu na tyle dÅ‚ugo, Å¼e moÅ¼e to sprawiÄ‡ problem. DziÅ› oszczÄ™dnoÅ›Ä‡ dwÃ³ch cyfr wydaje siÄ™ Å›mieszna, jednak naleÅ¼y wziÄ…Ä‡ pod uwagÄ™, iÅ¼, przykÅ‚adowo, jeden z pierwszych popularnych komputerÃ³w typu mainframe â€” IBM 1401 miaÅ‚ zaledwie 2 kilobajty pamiÄ™ci.

Na to niedociÄ…gniÄ™cie zwracaÅ‚ uwagÄ™ Bob Bemer juÅ¼ w 1958 roku, ale wÃ³wczas maÅ‚o kto byÅ‚ tym zainteresowany. Problem zaczÄ™to braÄ‡ na powaÅ¼nie dopiero w pÃ³Åºniejszych latach, w szczegÃ³lnoÅ›ci dopiero w latach 90. KÅ‚opoty zaczÄ™Å‚y siÄ™ jeszcze przed 2000 rokiem, np. karty kredytowe z datÄ… waÅ¼noÅ›ci po 1999 roku potrafiÅ‚y byÄ‡ odrzucane jako niewaÅ¼ne.

Problem rozwiÄ…zano na wiele sposobÃ³w. WymieniajÄ…c przykÅ‚adowe:

- Najbardziej oczywistym byÅ‚o rozszerzenie roku z dwÃ³ch cyfr do czterech. Niestety, o ile rozwiÄ…zanie to jest najczystsze, to jednak sprawia kÅ‚opot, poniewaÅ¼ wymaga konwersji danych, w tym bardzo czÄ™sto Å‚Ä…cznie z typem danych.
- Ciekawym tymczasowym obejÅ›ciem byÅ‚o tzw. â€date windowingâ€. PolegaÅ‚o na tym, Å¼e odgÃ³rnie zakÅ‚adano, ktÃ³ry przedziaÅ‚ dwucyfrowych lat bÄ™dzie naleÅ¼eÄ‡ do XX wieku, a ktÃ³ry do XXI wieku. Na przykÅ‚ad zakÅ‚adano, Å¼e lata wiÄ™ksze od 70 to XX wiek, natomiast mniejsze to XXI wiek. Jest to oczywiÅ›cie tylko tymczasowe rozwiÄ…zanie, ktÃ³re byÅ‚o traktowane jako przejÅ›ciowe przed migracjÄ… na nowe, lepsze systemy.
- Kolejnym ciekawym i nietypowym podejÅ›ciem byÅ‚a zmiana formatu zapisu daty. W bazach danych, gdzie datÄ™ zapisywano za pomocÄ… szeÅ›ciu cyfr (po dwie cyfry na rok, miesiÄ…c i dzieÅ„), zmieniono konwencjÄ™, aby przechowywaÄ‡ trzy cyfry roku i trzy cyfry dnia roku. PrzykÅ‚adowo, w takim zapisie rok 1999 byÅ‚ zapisany jako 099, a 2001 jako 101. Przesuwa to problem dat na rok 2899, jednak moÅ¼na doÅ›Ä‡ bezpiecznie zaÅ‚oÅ¼yÄ‡, Å¼e systemy do tego czasu zostanÄ… zastÄ…pione innymi.

### 19 stycznia 2038

19 stycznia 2038 to data, kiedy przekrÄ™ci siÄ™ licznik czasu uniksowego w zapisie 32-bitowym (zmienna ze znakiem). Jest to wbrew pozorom spory problem, poniewaÅ¼ Uniksy i systemy uniksopodobne to najpopularniejsze systemy do zastosowaÅ„ profesjonalnych, systemÃ³w wbudowanych, a takÅ¼e na nich stoi zdecydowana wiÄ™kszoÅ›Ä‡ urzÄ…dzeÅ„ sieciowych. Nawet pomijajÄ…c te systemy, to wiele jÄ™zykÃ³w programowania, nawet na Windowsie, wewnÄ™trznie posÅ‚uguje siÄ™ wÅ‚aÅ›nie tym sposobem zapisu czasu (np. typ danych time_t w jÄ™zyku C).

RozwiÄ…zanie problemu wydaje siÄ™ byÄ‡ proste i oczywiste â€” zmieniÄ‡ rozmiar zmiennej do 64 bitÃ³w. Nie jest to jednak takie Å‚atwe, jak mogÅ‚oby siÄ™ wydawaÄ‡. Zmiany wprowadza siÄ™ stopniowo i tak, aby najlepiej nie popsuÄ‡ kompatybilnoÅ›ci nowych wersji oprogramowania ze starymi. WymieniajÄ…c kilka rzeczy:

- WiÄ™kszoÅ›Ä‡ systemÃ³w uruchamianych na 64-bitowych architekturach procesorÃ³w rozszerza rozmiar czasu uniksowego do 64-bitowej zmiennej.
- Proponowano przejÅ›cie ze znakowej wersji zmiennej do bezznakowej, tym samym zwiÄ™kszajÄ…c jej zakres do 7 lutego 2106 roku. Niestety, w ten sposÃ³b uniemoÅ¼liwia siÄ™ zapis dat sprzed 1970 roku, ktÃ³re to wÅ‚aÅ›nie zapisuje siÄ™ ujemnÄ… liczbÄ… sekund.
- RÃ³Å¼ne jÄ™zyki programowania wprowadziÅ‚y dokÅ‚adniejszy zapis w mili- bÄ…dÅº mikrosekundach od 1970 roku, przechowywany rÃ³wnieÅ¼ w formie 64-bitowej. Robi tak choÄ‡by wspomniany juÅ¼ wczeÅ›niej przeze mnie JavaScript, ale takÅ¼e i Java.
- Å»eby wskazaÄ‡, Å¼e problem jest rozwiÄ…zywany do dziÅ›, warto pokazaÄ‡, Å¼e system plikÃ³w XFS, wykorzystywany czasem pod Linuksem, dostaÅ‚ rozwiÄ…zanie problemu roku 2038 dopiero w grudniu 2020, wraz z pojawieniem siÄ™ Linuksa 5.10.

### Inne moÅ¼liwe i niemoÅ¼liwe daty koÅ„ca czasu

Dwa poprzednie przypadki byÅ‚y najpopularniejsze, jednak moÅ¼emy wyrÃ³Å¼niÄ‡ jeszcze wiele innych, ciekawych dat, kiedy odliczanie czasu na komputerach siÄ™ popsuje, albo juÅ¼ siÄ™ popsuÅ‚o i trzeba byÅ‚o naprawiaÄ‡ tego efekty. CzÄ™Å›Ä‡ z nich potraktuj jako przestrogÄ™ podczas pisania swoich programÃ³w, a czÄ™Å›Ä‡ jako ciekawostkÄ™, moÅ¼e nawet i Å›miesznÄ….

- 1978 â€” bardzo ciekawy przypadek: twÃ³rcy systemu OS/8 dla komputerÃ³w PDP-8 uznali, Å¼e 3 bity to wystarczajÄ…ca liczba, aby zapisaÄ‡ rok. Tym samym komputery z takim systemem obsÅ‚ugiwaÅ‚y jedynie daty miÄ™dzy 1970 a 1977 rokiem.
- 22.08.1999, 06.04.2019 i 20.11.2038 â€” to daty przekrÄ™cenia siÄ™ licznika tygodni w systemie GPS. Jak widaÄ‡, dwie z tych dat byÅ‚y juÅ¼ za nami i wiÄ™kszoÅ›Ä‡ systemÃ³w bazujÄ…cych na dacie z GPS-u daÅ‚a radÄ™, moÅ¼e z wyjÄ…tkiem niezaktualizowanych iPhonÃ³w i iPadÃ³w wydanych przed rokiem 2012. Warto jednak wspomnieÄ‡, Å¼e aby zapobiec temu problemowi w 2038 roku, w najnowszej wersji protokoÅ‚u zwiÄ™kszono zmiennÄ… przechowujÄ…cÄ… liczbÄ™ tygodni z 10 bitÃ³w do 13.
- 2010 â€” w tym przypadku problem polegaÅ‚ na tym, Å¼e 10 w zapisie dziesiÄ™tnym to inna liczba niÅ¼ 10 w systemie szesnastkowym. W systemach, ktÃ³re kodowaÅ‚y daty w postaci BCD, powodowaÅ‚o to problem w przypadku zÅ‚ego odczytu. PrzykÅ‚adowo, protokÃ³Å‚ wiadomoÅ›ci SMS przechowuje daty w tej postaci i niektÃ³re telefony zaczÄ™Å‚y podawaÄ‡ datÄ™ 2016 zamiast 2010.
- 2020 â€” doÅ›Ä‡ ciekawe jest, Å¼e niektÃ³re systemy nie potrafiÅ‚y ustawiÄ‡ roku 2020 albo aplikacje nie potrafiÅ‚y odczytaÄ‡ takiej daty z systemu. Ten problem byÅ‚ zresztÄ… doÅ›Ä‡ gÅ‚oÅ›ny w naszym kraju, kiedy to na poczÄ…tku roku przestaÅ‚y dziaÅ‚aÄ‡ kasy fiskalne w tysiÄ…cach sklepÃ³w i kin. A chyba najÅ›mieszniejszym przypadkiem zwiÄ…zanym z tym rokiem byÅ‚o to, Å¼e wspomniany bÅ‚Ä…d znajdowaÅ‚ siÄ™ w grze WWE 2K20, ktÃ³ra byÅ‚a wydana.... w paÅºdzierniku 2019 roku.
- 7.02.2036 â€” w tym roku nastÄ…pi przepeÅ‚nienie zmiennej przechowujÄ…cej czas w protokole NTP. Problem jednak zdaje siÄ™ byÄ‡ rozwiÄ…zany przez NTPv4, ktÃ³re rozszerza zapis czasu z 64  na 128 bitÃ³w.
- 06.02.2040, 31.12.2107 â€” w tych latach skoÅ„czÄ… siÄ™ liczniki czasÃ³w systemÃ³w plikÃ³w: kolejno HFS+ (Apple) i FAT (DOS, Windows i pamiÄ™ci przenoÅ›ne). O ile ten pierwszy jest juÅ¼ coraz czÄ™Å›ciej zastÄ…piony przez APFS, o tyle ten drugi nie zapowiada siÄ™, by miaÅ‚ byÄ‡ czymÅ› zastÄ…piony. Co wiÄ™cej, problem ten dotknie teÅ¼ format plikÃ³w ZIP, ktÃ³ry wewnÄ™trznie teÅ¼ ma to samo ograniczenie, co system FAT.
- Lata przestÄ™pne (np. 1996, 2012, 2020, 2100) â€” okazuje siÄ™, Å¼e wiele programÃ³w, a czasem nawet systemÃ³w, Åºle oblicza lata przestÄ™pne. Jak wiemy, wystÄ™pujÄ… one co cztery lata, jednak z wyjÄ…tkiem lat podzielnych przez 100 i jednoczeÅ›nie niepodzielnych przez 400. Niestety programiÅ›ci zapominajÄ… o tej regule, przez co pojawiÅ‚ siÄ™ problem choÄ‡by w roku 2000 i prawdopodobnie pojawi siÄ™ teÅ¼ w roku 2100. InnÄ… sprawÄ… jest to, Å¼e niektÃ³rzy zapominali caÅ‚kowicie o latach przestÄ™pnych, przez co, np. w 2012 roku awariÄ™ zaliczyÅ‚y Gmail oraz Azure.
- 2137 â€” tego roku znowu przekrÄ™ci siÄ™ licznik czasu systemu GPS, tym razem po rozszerzeniu do zmiennej 13-bitowej. Przepraszam, jeÅ›li spodziewaÅ‚eÅ› siÄ™, Å¼e w tym roku â€odjaniepawli siÄ™â€ coÅ› ciekawszego.
- 10000 â€” pamiÄ™tasz problem roku 2000 zwiÄ…zany z zapisem roku dwoma cyframi? Za prawie 8 tysiÄ™cy lat bÄ™dzie powtÃ³rka z rozrywki, bo obecnie rok zapisujemy czterema cyframi ğŸ™‚.
- 14.09.30828 â€” tego dnia koÅ„czy siÄ™ zapis daty w systemach z rodziny Windows. Dlaczego? PoniewaÅ¼ przechowuje datÄ™ w 64-bitach jako liczba 100-nanosekundowych interwaÅ‚Ã³w od roku 1601. JednakÅ¼e doÅ›Ä‡ wÄ…tpliwe jest, Å¼e do tego roku ktoÅ› jeszcze bÄ™dzie korzystaÄ‡ z tego systemu.
- 17.08.292278994 (za 292 miliony lat) â€” wÅ‚aÅ›nie tego dnia przekrÄ™ci siÄ™ licznik czasu w Javie, ktÃ³ry na 64 bitach zapisuje liczbÄ™ milisekund, jakie upÅ‚ynÄ™Å‚y od 1 stycznia 1970 roku. Ciekawe, czy wtedy wciÄ…Å¼ bÄ™dÄ… 3 miliardy urzÄ…dzeÅ„ z JavÄ….
- 04.12.292277026596 (za 292 miliardy lat) â€” tego dnia przekrÄ™ci siÄ™ licznik czasu uniksowego zapisywanego w zmiennej 64-bitowej. Absolutnie jednak nie ma czym siÄ™ przejmowaÄ‡. JeÅ¼eli rÃ³wnanie Drake'a jest poprawne, to moÅ¼liwe jest, Å¼e nasza cywilizacja skoÅ„czy siÄ™ za 10 tysiÄ™cy lat (albo 100 milionÃ³w lat, zaleÅ¼nie od tego, jak siÄ™ liczy). A nawet jeÅ›li przeÅ¼yjemy, to za okoÅ‚o miliard lat majÄ… wymrzeÄ‡ wszystkie organizmy eukariotyczne (czyli teÅ¼ my). Za prawie 8 miliardÃ³w lat Ziemia zostanie pochÅ‚oniÄ™ta przez SÅ‚oÅ„ce. Do tego zakÅ‚ada siÄ™, Å¼e za 22 miliardy lat moÅ¼e dojÅ›Ä‡ do koÅ„ca WszechÅ›wiata (scenariusz Wielkiego Rozdarcia). Jak widaÄ‡, nie ma szans na osiÄ…gniÄ™cie tej daty.

## Podsumowanie

Mam wraÅ¼enie, Å¼e juÅ¼ nie raz pisaÅ‚em na blogu, iÅ¼ temat artykuÅ‚u wydaje siÄ™ byÄ‡ prosty i oczywisty, jednak gdy siÄ™ w niego zagÅ‚Ä™bimy, to przestaje takim byÄ‡. Nie inaczej jest w kwestii czasu. Jak sam(a) widzisz, jest to bardzo rozlegÅ‚y temat. Z jednej strony mamy ciekawe rozwiÄ…zania sprzÄ™towe sÅ‚uÅ¼Ä…ce do odmierzania go, a z drugiej strony przerÃ³Å¼ne sposoby jego przechowywania i obsÅ‚ugi w oprogramowaniu.

To, co pokazaÅ‚em tutaj na przestrzeni obu artykuÅ‚Ã³w, mimo Å¼e zajÄ™Å‚o doÅ›Ä‡ duÅ¼o tekstu, to jest zaledwie draÅ›niÄ™ciem tematu. Jest wiele drobnych niuansÃ³w zwiÄ…zanych z datami i czasem, ktÃ³re moÅ¼na podsumowaÄ‡ w doÅ›Ä‡ prosty sposÃ³b â€” nie prÃ³buj wynaleÅºÄ‡ koÅ‚a na nowo. Korzystaj z dostÄ™pnych w systemie/jÄ™zyku programowania funkcji obsÅ‚ugi dat i czasu. NaprawdÄ™ zbyt wiele wpadek moÅ¼na popeÅ‚niÄ‡ po drodze, zwiÄ…zanych zarÃ³wno z przeszÅ‚oÅ›ciÄ…, teraÅºniejszoÅ›ciÄ…, jak i przyszÅ‚oÅ›ciÄ… (o czym powinien uÅ›wiadomiÄ‡ poprzedni akapit). Niech Twoje oprogramowanie powiela ograniczenia jÄ™zyka albo systemu, a nie tworzy kolejne, z ewentualnymi bÅ‚Ä™dami.

## Literatura

- Epoch (computing), [https://en.wikipedia.org/w/index.php?title=Epoch_(computing)&oldid=1025205918](https://en.wikipedia.org/w/index.php?title=Epoch_(computing)&oldid=1025205918) (ostatnie odwiedziny 09.06.2021)
- System time, [https://en.wikipedia.org/w/index.php?title=System_time&oldid=1018536065](https://en.wikipedia.org/w/index.php?title=System_time&oldid=1018536065) (ostatnie odwiedziny 09.06.2021)
- â€The Open Group Base Specifications Issue 7, section 4.16 Seconds Since the Epoch". The Open Group: [https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_16](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_16) (ostatnie odwiedziny 09.06.2021)
- ISO 8601, [https://en.wikipedia.org/w/index.php?title=ISO_8601&oldid=1027217295](https://en.wikipedia.org/w/index.php?title=ISO_8601&oldid=1027217295) (ostatnie odwiedziny 09.06.2021)
- RFC 3339, [https://datatracker.ietf.org/doc/html/rfc3339](https://datatracker.ietf.org/doc/html/rfc3339) (ostatnie odwiedziny 09.06.2021)
- Neagoe, Teodor, Valentin Cristea, and Logica Banica. "NTP versus PTP in com puter networks clock synchronization." *2006 IEEE International Symposium on Industrial Electronics*. Vol. 1. IEEE, 2006.
- â€3.3.4 GPS Time and SV Z-Count.â€, [NAVSTAR GPS Space Segment/Navigation User Segment Interfaces (GPS-IS-200K)](https://www.gps.gov/technical/icwg/IS-GPS-200K.pdf), 06.05.2019
- DCF77, [https://www.ptb.de/cms/en/ptb/fachabteilungen/abt4/fb-44/ag-442/dissemination-of-legal-time/dcf77.html](https://www.ptb.de/cms/en/ptb/fachabteilungen/abt4/fb-44/ag-442/dissemination-of-legal-time/dcf77.html) (ostatnie odwiedziny 09.06.2021)
- Britannica, The Editors of Encyclopaedia. "Y2K bug". *Encyclopedia Britannica*, Apr 21, 2021, [https://www.britannica.com/technology/Y2K-bug](https://www.britannica.com/technology/Y2K-bug). Accessed 9 June 2021.
- Time formatting and storage bugs, [https://en.wikipedia.org/w/index.php?title=Time_formatting_and_storage_bugs&oldid=1027624749](https://en.wikipedia.org/w/index.php?title=Time_formatting_and_storage_bugs&oldid=1027624749) (ostatnie odwiedziny 09.06.2021)

<small>ZdjÄ™cie na okÅ‚adce: SchiDD, CC BY-SA 4.0 [https://creativecommons.org/licenses/by-sa/4.0](https://creativecommons.org/licenses/by-sa/4.0), via Wikimedia Commons</small>
